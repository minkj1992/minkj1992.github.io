<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>CKA certificate | minkj1992</title><meta name="Description" content="I love ocean, moon, sun, breeze, plant, philosopher, believer, Taoism, artist, masters, learning, reading, coding, talking, teaching, praying."><meta property="og:url" content="https://minkj1992.github.io/cka/">
  <meta property="og:site_name" content="minkj1992">
  <meta property="og:title" content="CKA certificate">
  <meta property="og:description" content="MLflow ambassador 혜택으로 linux foundation의 무료 수강권을 얻을 수 있어서, k8s 자격증 시리즈를 구매했다. 이 참에 cka -&gt; ckad -&gt; cks를 빠르게 따볼 계획이다.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-19T12:41:18+09:00">
    <meta property="article:modified_time" content="2024-05-09T21:51:15+09:00">
    <meta property="article:tag" content="Dev">
    <meta property="og:image" content="https://minkj1992.github.io/images/profile3.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://minkj1992.github.io/images/profile3.png"><meta name="twitter:title" content="CKA certificate">
<meta name="twitter:description" content="MLflow ambassador 혜택으로 linux foundation의 무료 수강권을 얻을 수 있어서, k8s 자격증 시리즈를 구매했다.
이 참에 cka -&gt; ckad -&gt; cks를 빠르게 따볼 계획이다.">
<meta name="application-name" content="minkj1992">
<meta name="apple-mobile-web-app-title" content="minkj1992"><meta name="theme-color" content="#DB6B97"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://minkj1992.github.io/cka/" /><link rel="prev" href="https://minkj1992.github.io/mlflow_doc/" /><link rel="next" href="https://minkj1992.github.io/cka_mock_test/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CKA certificate",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/minkj1992.github.io\/cka\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/minkj1992.github.io\/images\/profile2.jpeg",
                            "width":  1078 ,
                            "height":  1082 
                        }],"genre": "posts","keywords": "dev","wordcount":  10321 ,
        "url": "https:\/\/minkj1992.github.io\/cka\/","datePublished": "2024-04-19T12:41:18+09:00","dateModified": "2024-05-09T21:51:15+09:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "minkj1992","logo": {
                    "@type": "ImageObject",
                    "url": "https:\/\/minkj1992.github.io\/images\/profile3.png",
                    "width":  1362 ,
                    "height":  1868 
                }},"author": {
                "@type": "Person",
                "name": "leoo.j"
            },"description": ""
    }
    </script><meta name="msapplication-TileColor" content="#FFF" />
<meta name="theme-color" content="#FFF" />
<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png" />
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/android-icon-36x36.png" sizes="36x36" />
<link rel="icon" type="image/png" href="/android-icon-48x48.png" sizes="48x48" />
<link rel="icon" type="image/png" href="/android-icon-72x72.png" sizes="72x72" />
<link rel="icon" type="image/png" href="/android-icon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="/android-icon-144x144.png" sizes="144x144" />
<link rel="icon" type="image/png" href="/android-icon-192x192.png" sizes="192x192" />
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png" />
<meta name="msapplication-square70x70logo" content="/ms-icon-70x70.png" />
<meta name="msapplication-square150x150logo" content="/ms-icon-150x150.png" />
<meta name="msapplication-wide310x150logo" content="/ms-icon-310x150.png" />
<meta name="msapplication-square310x310logo" content="/ms-icon-310x310.png" />
<link href="/apple-startup-320x460.png"
    media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)"
    rel="apple-touch-startup-image" />
<link href="/apple-startup-640x920.png"
    media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)"
    rel="apple-touch-startup-image" />
<link href="/apple-startup-640x1096.png"
    media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"
    rel="apple-touch-startup-image" />
<link href="/apple-startup-748x1024.png"
    media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 1) and (orientation: landscape)"
    rel="apple-touch-startup-image" />
<link href="/apple-startup-750x1024.png" media="" rel="apple-touch-startup-image" />
<link href="/apple-startup-750x1294.png"
    media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)"
    rel="apple-touch-startup-image" />
<link href="/apple-startup-768x1004.png"
    media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 1) and (orientation: portrait)"
    rel="apple-touch-startup-image" />
<link href="/apple-startup-1182x2208.png"
    media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    rel="apple-touch-startup-image" />
<link href="/apple-startup-1242x2148.png"
    media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    rel="apple-touch-startup-image" />
<link href="/apple-startup-1496x2048.png"
    media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    rel="apple-touch-startup-image" />
<link href="/apple-startup-1536x2008.png"
    media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    rel="apple-touch-startup-image" />
<link rel="manifest" href="/manifest.json" /></head>

<body data-header-desktop="auto"
    data-header-mobile="auto"><script
        type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="minkj1992"><span class="header-title-pre"><span style='color: Mediumslateblue;'><</span></span><span id="id-1" class="typeit"></span><span class="header-title-post"><span style='color: Mediumslateblue;'>/></span></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="https://github.com/minkj1992" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="minkj1992"><span class="header-title-pre"><span style='color: Mediumslateblue;'><</span></span><span id="id-2" class="typeit"></span><span class="header-title-post"><span style='color: Mediumslateblue;'>/></span></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="https://github.com/minkj1992" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
            <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">CKA certificate</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/minkj1992" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>leoo.j</a>
</span>&nbsp;<span class="post-category">included in <a href="/categories/cka/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Cka</a>&nbsp;<a href="/categories/k8s/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>K8s</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-04-19">2024-04-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;10321 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;49 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/cka1.png"
        data-srcset="/images/cka1.png, /images/cka1.png 1.5x, /images/cka1.png 2x"
        data-sizes="auto"
        alt="/images/cka1.png"
        title="/images/cka1.png" /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisite">Prerequisite</a></li>
    <li><a href="#planning">Planning</a></li>
  </ul>

  <ul>
    <li><a href="#cluster-architecture">Cluster architecture</a></li>
    <li><a href="#docker-vs-containerd">Docker vs containerd</a></li>
    <li><a href="#etcd">ETCD</a></li>
    <li><a href="#etcd-in-k8s">etcd in k8s</a></li>
    <li><a href="#kube-api-server">kube-api server</a></li>
    <li><a href="#kube-controller-manager">Kube controller manager</a></li>
    <li><a href="#kube-scheduler">Kube scheduler</a></li>
    <li><a href="#kubelet">Kubelet</a></li>
    <li><a href="#kube-proxy">Kube proxy</a></li>
    <li><a href="#pod">Pod</a></li>
    <li><a href="#replicaset">Replicaset</a></li>
    <li><a href="#deployments">Deployments</a></li>
    <li><a href="#services">Services</a>
      <ul>
        <li>
          <ul>
            <li><a href="#nodeport">NodePort</a></li>
            <li><a href="#how-do-i-verify-if-the-nodeport-service-and-the-pod-are-properly-connected">How do I verify if the NodePort service and the pod are properly connected?</a></li>
            <li><a href="#a-service-with-multipe-pods-with-single-service">A service with multipe pods with single service</a></li>
            <li><a href="#when-pods-are-distributed-across-multiple-nodes">When pods are distributed across multiple nodes</a></li>
            <li><a href="#clusterip">ClusterIP</a></li>
            <li><a href="#loadbalancer">LoadBalancer</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#namespaces">Namespaces</a>
      <ul>
        <li>
          <ul>
            <li><a href="#namespace-cli">namespace cli</a></li>
            <li><a href="#kubernetes-dns-rule">kubernetes DNS rule</a></li>
            <li><a href="#deterministic-namespace">deterministic namespace</a></li>
            <li><a href="#resourcequota">ResourceQuota</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#imperative">Imperative</a></li>
  </ul>

  <ul>
    <li><a href="#manual-schduling">Manual schduling</a></li>
    <li><a href="#labels-and-selectors">Labels and Selectors</a></li>
    <li><a href="#taints-and-tolerations">Taints and Tolerations</a></li>
    <li><a href="#node-affinity">Node affinity</a>
      <ul>
        <li><a href="#node-affinity-types">Node Affinity Types</a></li>
      </ul>
    </li>
    <li><a href="#taints-and-tolerations-and-node-affinity">Taints and tolerations and Node Affinity</a></li>
    <li><a href="#cli">cli</a></li>
    <li><a href="#resource-and-limit">Resource and Limit</a>
      <ul>
        <li><a href="#limit-cpu-vs-limit-memory">Limit cpu vs Limit memory</a>
          <ul>
            <li><a href="#memory"><strong>memory</strong></a></li>
            <li><a href="#cpu"><strong>cpu</strong></a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#daemon-sets">Daemon Sets</a>
      <ul>
        <li><a href="#how-to-create">How to create?</a></li>
      </ul>
    </li>
    <li><a href="#static-pods">Static pods</a>
      <ul>
        <li>
          <ul>
            <li><a href="#use-case">Use Case</a></li>
            <li><a href="#check-wheter-pod-is-static-or-not">Check wheter pod is static or not</a></li>
            <li><a href="#how-to-find-staticpodpath">How to find staticPodPath</a></li>
          </ul>
        </li>
        <li><a href="#how-to-create-staticpod">How to create staticPod</a></li>
        <li><a href="#how-to-find-staticpod-and-delete-it">How to find staticPod and delete it</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#configmap">Configmap</a></li>
    <li><a href="#secret">Secret</a></li>
  </ul>

  <ul>
    <li><a href="#node-upgrade-os-upgrade">Node upgrade (OS upgrade)</a></li>
    <li><a href="#kubernetes-software-versions">Kubernetes Software Versions</a></li>
    <li><a href="#cluster-upgrade-introduction">Cluster Upgrade Introduction</a></li>
    <li><a href="#upgrading-kubeadm-clusters">Upgrading kubeadm clusters</a>
      <ul>
        <li><a href="#1-upgrade-kubeadm-master-node">1. Upgrade kubeadm master node</a></li>
        <li><a href="#2-upgrade-kubeadm-worker-node">2. Upgrade kubeadm worker node</a></li>
        <li><a href="#3-problem-backup-and-restore-etcd">3. Problem: backup and restore etcd</a></li>
        <li><a href="#solution">Solution</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#authentication">Authentication</a></li>
    <li><a href="#tls-certificates">TLS Certificates</a>
      <ul>
        <li><a href="#format">Format</a></li>
      </ul>
    </li>
    <li><a href="#tls-in-kubernetes">TLS in kubernetes</a>
      <ul>
        <li><a href="#server-certificates-for-servers">Server Certificates for servers</a></li>
        <li><a href="#client-certificates-for-clients">Client Certificates for clients</a></li>
      </ul>
    </li>
    <li><a href="#kube-config">Kube config</a></li>
    <li><a href="#authorization">Authorization</a></li>
    <li><a href="#rbac">RBAC</a></li>
    <li><a href="#cluster-roles">Cluster Roles</a></li>
    <li><a href="#service-account">Service account</a></li>
    <li><a href="#image-security">Image security</a></li>
    <li><a href="#security-context">Security Context</a>
      <ul>
        <li>
          <ul>
            <li><a href="#attributes">Attributes</a></li>
            <li><a href="#how-to-check-capabilities">How to check capabilities</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#network-policies">Network policies</a>
      <ul>
        <li>
          <ul>
            <li><a href="#problem">Problem</a></li>
            <li><a href="#solution-1">Solution</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#ko">ko</a></li>
      </ul>
    </li>
    <li><a href="#csi-container-storage-interface">CSI (container storage interface)</a></li>
    <li><a href="#volume">Volume</a></li>
    <li><a href="#persistent-volume">Persistent Volume</a></li>
    <li><a href="#persistent-volume-claims">Persistent Volume Claims</a></li>
    <li><a href="#storage-class">Storage Class</a></li>
    <li><a href="#wrap-up">Wrap up</a></li>
  </ul>

  <ul>
    <li><a href="#switching-routing">Switching Routing</a>
      <ul>
        <li>
          <ul>
            <li><a href="#switching">Switching</a></li>
            <li><a href="#subnet-mask">subnet mask</a></li>
            <li><a href="#router--gateway">Router / Gateway</a></li>
            <li><a href="#default-destination">Default Destination</a></li>
            <li><a href="#what-if-gateway-0000">What if Gateway 0.0.0.0?</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#dns">DNS</a></li>
    <li><a href="#coredns">CoreDNS</a></li>
    <li><a href="#namespace">Namespace</a>
      <ul>
        <li>
          <ul>
            <li><a href="#create-netwok-ns">Create Netwok ns</a></li>
            <li><a href="#exec-in-network-ns">Exec in network ns</a></li>
            <li><a href="#arp">ARP</a></li>
            <li><a href="#switch">Switch</a></li>
            <li><a href="#route">Route</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#cf-linux-namespace">c.f) Linux namespace</a>
      <ul>
        <li><a href="#uts-namespace">UTS namespace</a></li>
      </ul>
    </li>
    <li><a href="#docker-networking">Docker Networking</a></li>
    <li><a href="#cni-container-networking-interface">CNI (Container Networking Interface)</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>MLflow ambassador 혜택으로 linux foundation의 무료 수강권을 얻을 수 있어서, k8s 자격증 시리즈를 구매했다.
이 참에 cka -&gt; ckad -&gt; cks를 빠르게 따볼 계획이다.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/cka2.png"
        data-srcset="/images/cka2.png, /images/cka2.png 1.5x, /images/cka2.png 2x"
        data-sizes="auto"
        alt="/images/cka2.png"
        title="/images/cka2.png" /></p>
<h2 id="prerequisite">Prerequisite</h2>
<blockquote>
<p><a href="https://training.linuxfoundation.org/full-catalog/#" target="_blank" rel="noopener noreffer">https://training.linuxfoundation.org/full-catalog/#</a>
</p>
</blockquote>
<ul>
<li><a href="https://docs.linuxfoundation.org/tc-docs/certification/tips-cka-and-ckad" target="_blank" rel="noopener noreffer">Important Insturctions: CKA and CKAD</a>
</li>
<li><a href="https://github.com/cncf/curriculum/blob/master/CKA_Curriculum_v1.29.pdf" target="_blank" rel="noopener noreffer">CKA Curriculum_v1.29</a>
</li>
</ul>
<center>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/CKA_Curriculum_v1.29-0.jpg"
        data-srcset="/images/CKA_Curriculum_v1.29-0.jpg, /images/CKA_Curriculum_v1.29-0.jpg 1.5x, /images/CKA_Curriculum_v1.29-0.jpg 2x"
        data-sizes="auto"
        alt="/images/CKA_Curriculum_v1.29-0.jpg"
        title="/images/CKA_Curriculum_v1.29-0.jpg" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/CKA_Curriculum_v1.29-1.jpg"
        data-srcset="/images/CKA_Curriculum_v1.29-1.jpg, /images/CKA_Curriculum_v1.29-1.jpg 1.5x, /images/CKA_Curriculum_v1.29-1.jpg 2x"
        data-sizes="auto"
        alt="/images/CKA_Curriculum_v1.29-1.jpg"
        title="/images/CKA_Curriculum_v1.29-1.jpg" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/CKA_Curriculum_v1.29-2.jpg"
        data-srcset="/images/CKA_Curriculum_v1.29-2.jpg, /images/CKA_Curriculum_v1.29-2.jpg 1.5x, /images/CKA_Curriculum_v1.29-2.jpg 2x"
        data-sizes="auto"
        alt="/images/CKA_Curriculum_v1.29-2.jpg"
        title="/images/CKA_Curriculum_v1.29-2.jpg" /></p>
</center>
<h2 id="planning">Planning</h2>
<ol>
<li>CNCF endorsed udemy lecture <a href="https://www.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/" target="_blank" rel="noopener noreffer">Certified Kubernetes Administrator (CKA) with Practice Tests</a>
를 듣는다.</li>
<li><a href="https://github.com/kodekloudhub/certified-kubernetes-administrator-course" target="_blank" rel="noopener noreffer">Course 필기</a>
를 참조해서 복습</li>
<li>실습이 필요하다면 <a href="https://github.com/kelseyhightower/kubernetes-the-hard-way/tree/master" target="_blank" rel="noopener noreffer">kubernetes-the-hard-way</a>
 셋업해서 로컬에서 연습해볼 예정</li>
</ol>
<p>하루 약 3~4시간씩 강의를 들어보자 약 23시간 강의이기 때문에 다 듣는데 약 5~6일 소요되기 때문에, 일주일 뒤에 테스트볼 예정이다. (~ 24.4.26)</p>
<blockquote>
<p>edit, practice에 대한 시간이 빠져있었다. 조금 일정을 미뤄 + 2일뒤인 24.4.28에 시험을 볼 예정이다.</p>
</blockquote>
<p>24.04.19 ~ 24.05.08</p>
<p>중간에 모두의 연구소와 아주대 멘토링 그리고 mlflow 엠버서더 활동때문에 일주일을 <a href="https://github.com/minkj1992/llama3-langchain-mlflow" target="_blank" rel="noopener noreffer">다른 곳</a>
에 신경써야했지만, 그래도 다행히 아이펠 과정 본격적으로 시작하기 전에 빠르게 합격한 것 같다. (합격 여부만 나오고 아직 점수를 확인을 못해서 업데이트를 기다려야 할 것 같다.)</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/cka.png"
        data-srcset="/images/cka.png, /images/cka.png 1.5x, /images/cka.png 2x"
        data-sizes="auto"
        alt="/images/cka.png"
        title="/images/cka.png" /></p>
<h1 id="chapter-2-core-concepts">Chapter 2: Core concepts</h1>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-full.png"
        data-srcset="/images/k8s-full.png, /images/k8s-full.png 1.5x, /images/k8s-full.png 2x"
        data-sizes="auto"
        alt="/images/k8s-full.png"
        title="/images/k8s-full.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-full2.png"
        data-srcset="/images/k8s-full2.png, /images/k8s-full2.png 1.5x, /images/k8s-full2.png 2x"
        data-sizes="auto"
        alt="/images/k8s-full2.png"
        title="/images/k8s-full2.png" /></p>
<h2 id="cluster-architecture">Cluster architecture</h2>
<ul>
<li>Master: Manage, Plan, Schedule, Monitor nodes
<ul>
<li>etcd cluster: save, distributed</li>
<li>kube-apiserver: orch all within cluster</li>
<li>kube controller manager: run many controller (node, replica )</li>
<li>kube-scheduler</li>
</ul>
</li>
<li>Worker Nodes
<ul>
<li>kubelet: api client</li>
<li>kube-proxy: enable communication with other service</li>
<li>container runtime
<ul>
<li>docker, rkt, containerd, crio, podman&hellip;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="docker-vs-containerd">Docker vs containerd</h2>
<ul>
<li>
<p>k8s(CRI &lt;&mdash; OCI)  &lt;-&gt; runtime (docker, rkt, podman&hellip;)</p>
</li>
<li>
<p>containerd가 실제 k8s의 CRI( container runtime interface)와 호환되며, containerd는 최초의 docker의 runtime</p>
</li>
<li>
<p>crictl is belongs to k8s, netctl and ctl is belongs to containerd</p>
</li>
</ul>
<h2 id="etcd">ETCD</h2>
<ul>
<li>key-value store
<ul>
<li>stores information in the form of document or pages</li>
</ul>
</li>
</ul>
<blockquote>
<p><a href="https://tech.kakao.com/2021/12/20/kubernetes-etcd/" target="_blank" rel="noopener noreffer">https://tech.kakao.com/2021/12/20/kubernetes-etcd/</a>
</p>
</blockquote>
<p><a href="https://tech.kakao.com/storage/2021/12/01-2.png" target="_blank" rel="noopener noreffer">etcd kakao</a>
</p>
<ul>
<li>높은 신뢰성을 제공하기 위해 ETCD는 RSM(Replicated state machine)이다.</li>
<li>이는 똑같은 데이터를 여러 서버에 계속 복제하는 것이고, 이 방법을 사용하는 머신을 RSM이라 칭합니다.</li>
<li>여러 서버에 복제하게 되면 발생하는 데이터 복제 과정에서 발생하는 여러 문제를 해결하기 위해 consensus를 확보하는 것이 핵심이며, 아래 4가지 속성을 만족한다는 것을 뜻합니다.</li>
<li>etcd는 Raft알고리즘을 통해 이를 구현합니다.
<ol>
<li>Safety</li>
<li>Available</li>
<li>Independent from timing</li>
<li>reactivity</li>
</ol>
</li>
</ul>
<p><a href="https://medium.com/@extio/deep-dive-into-etcd-a-distributed-key-value-store-a6a7699d3abc" target="_blank" rel="noopener noreffer">etcd dive deep</a>
</p>
<ul>
<li>leader만 write 가능 이후 이를 follower에게 전파하여 append log</li>
<li>follower는 client로 부터 read 요청을 처리 가능하다. (Q. timinig )</li>
</ul>
<p><a href="https://etcd.io/docs/v3.3/learning/api_guarantees/" target="_blank" rel="noopener noreffer">etcd kv api</a>
</p>
<p>etcd tries to <strong>ensure the strongest consistency</strong> and durability guarantees for a distributed system. This specification enumerates the <strong>KV API</strong> guarantees made by etcd.</p>
<ol>
<li>Atomicity: 모든 API request are atomic</li>
<li>Consistency: All Api calls ensure <a href="https://en.wikipedia.org/wiki/Consistency_model#Sequential_consistency" target="_blank" rel="noopener noreffer">sequential consistency</a>
, the strongest consistency guarantee ava from distributed systems</li>
</ol>
<ul>
<li>엄격한 일관성 모델보다 약한 메모리 모델입니다.</li>
<li>변수에 대한 쓰기는 즉시 표시될 필요는 없지만, 서로 다른 프로세서에 의한 변수에 대한 쓰기는 모든 프로세서에서 동일한 순서로 표시되어야 합니다.</li>
<li>모든 실행 결과가 데이터 저장소에 있는 모든 프로세스의 (읽기 및 쓰기) 작업이 순차적 순서로 실행된 것과 동일하고 각 개별 프로세서의 작업이 이 순서대로 나타나는 경우 순차적 일관성이 충족됩니다</li>
</ul>
<p>For watch operations, etcd guarantees to return the same value for the same key across all members for the same revision.</p>
<blockquote>
<p>it is impossible for etcd to ensure strict consistency. etcd does not guarantee that it will return to a read the “most recent” value (as measured by a wall clock when a request is completed) available on any cluster member.</p>
</blockquote>
<h2 id="etcd-in-k8s">etcd in k8s</h2>
<p><code>--advertise-client-urls</code>(internal_ip:3479): uri that etcd will listen, kubeapi가 여기로 접근</p>
<h2 id="kube-api-server">kube-api server</h2>
<blockquote>
<p><a href="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/docs/02-Core-Concepts/06-Kube-API-Server.md" target="_blank" rel="noopener noreffer">https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/docs/02-Core-Concepts/06-Kube-API-Server.md</a>
</p>
</blockquote>
<ul>
<li>We can trigger kube-apiserver by kubectl and kubeadm or directly we can send request to kube-apiserver by api(i.g. curl)</li>
<li>Kube-apiserver is the only componenet that iteracts directly to the etcd datastore</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">curl -X POST /api/v1/namespaces/default/pods ... [other]
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>Authenticate User</li>
<li>Validate Request</li>
<li>Retrieve data</li>
<li>Update ETCD</li>
<li>Scheduler
<ul>
<li>kube-scheduler keep watching kube-apiserver so that it can know when etcd changes</li>
<li>etcd changed -&gt; scheduler check and identifies right node to put pod on -&gt; request to kube-apiserver -&gt; send request to kubelet</li>
</ul>
</li>
<li>kubelet</li>
</ol>
<h2 id="kube-controller-manager">Kube controller manager</h2>
<p>Kube Controller manager manages various controllers in k8s. Then what is controller?</p>
<p>In k8s terms, a controller is a process that continuously monitors the state of the componenets within the system and works towards bringing the whole system to the desired functioning state</p>
<blockquote>
<p>In Kubernetes, controllers are control <strong>loops</strong> that watch the state of your cluster, then make or request changes where needed. Each controller tries to move the current cluster state closer to the desired state</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">--node-monitor-period duration     Default: 5s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">--node-monitor-grace-period duration     Default: 40s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/#taint-based-evictions
</span></span><span class="line"><span class="cl">`pod-eviction-timeout flag is deprecated as per v1.26 . -&gt; tolerationSeconds
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="kube-scheduler">Kube scheduler</h2>
<p>Kube-scheduler is responsible for scheduling pods on nodes. The kube-schduler is only responsible for deciding which pod goes on which node. It doesn&rsquo;t actually place the pod on the nodes, that&rsquo;s the job of the <code>kubelet</code></p>
<p>Schedule pod &lt;-&gt; node</p>
<ol>
<li>Filter Nodes</li>
<li>Rank Nodes</li>
<li>Post state which node to shcdule</li>
</ol>
<h2 id="kubelet">Kubelet</h2>
<p>The kubelet is the primary &ldquo;node agent&rdquo; that runs on each node. It can register the node with the <code>apiserver</code>. The lifecycle of the kubeadm CLI tool is decoupled from the kubelet, which is a daemon that runs on each node within the Kubernetes cluster. It means you have to install kubelet and kubeadm when you init cluster by kubeadm.</p>
<ul>
<li>The kubelet will create the pods on the Nodes</li>
<li>Monitor Node &amp; Pods</li>
</ul>
<h2 id="kube-proxy">Kube proxy</h2>
<ul>
<li>kube-proxy is a network proxy that runs on each node in cluster, implementing part of the kubernetes <code>Service</code> concept.</li>
<li>kube-proxy maintains network rules on nodes, allow network communication to pods from network sessions inside or outside of cluster.</li>
<li>It uses the operating system packet filtering layer (OSI-L3) if can.</li>
</ul>
<h2 id="pod">Pod</h2>
<ul>
<li>single container pod</li>
<li>multi-container pod
<ul>
<li>pod &lt;-localhost-&gt; helper containers, also shares persist vol</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>get node</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">k get po -o wide
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>get yaml from running and edit on runtime</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># if already deployed
</span></span><span class="line"><span class="cl"># $ k get po redis -o yaml 
</span></span><span class="line"><span class="cl">$ kubectl run redis --image=redis123 --dry-run=client -o yaml &gt; redis.yaml
</span></span><span class="line"><span class="cl">$ k create -f redis.yaml
</span></span><span class="line"><span class="cl">$ k edit or vim redis.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># :%s/redis123/redis
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Q. k edit 으로 containerStatus를 edit하면 어떻게 되는거지?</li>
</ul>
<h2 id="replicaset">Replicaset</h2>
<ul>
<li>It is often used to guarantee the availability of a specified number of identical pods</li>
<li>Pods created from ReplicaSets can be distributed and executed on multiple nodes based on schduling, topologySpreadConstraints(affinity, maxSkew, labelSelector ..)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">-</span> <span class="n">scale</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">replace</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="deployments">Deployments</h2>
<p>A Deployment provides declarative updates for Pods and ReplicaSets.</p>
<p>The following are typical use cases for deployments</p>
<ol>
<li>rollout a ReplicaSet</li>
<li>Declare the new state of the Pods</li>
<li>Rollback to earlier deployment revision</li>
<li>Scale out deployment</li>
<li>Pause the rollout of a deployment</li>
</ol>
<blockquote>
<p>ReplicaSet-A for controlling your pods, then You wish to update your pods to a newer version, now you should create Replicaset-B, scale down ReplicaSet-A and scale up ReplicaSet-B by one step repeatedly <strong>(This process is known as rolling update).</strong></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">k</span> <span class="n">api</span><span class="o">-</span><span class="n">resources</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">deployment</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">create</span> <span class="n">deployment</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">nginx</span> <span class="n">nginx</span> <span class="o">--</span><span class="n">replicas</span><span class="o">=</span><span class="mi">4</span> <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span><span class="o">=</span><span class="n">client</span> <span class="o">-</span><span class="n">o</span> <span class="n">yaml</span> <span class="o">&gt;</span> <span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span><span class="o">.</span><span class="n">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="services">Services</h2>
<p>Kubernetes Services enables communication between various components within and outside of the application.</p>
<ul>
<li>NodePort: Where the service makes an internal port accessible on a port on the NODE.</li>
<li>ClusterIP</li>
<li>LoadBalancer</li>
</ul>
<h4 id="nodeport">NodePort</h4>
<ul>
<li>NodePort uses node machine&rsquo;s port and Node&rsquo;s IP.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-nodeport1.png"
        data-srcset="/images/k8s-nodeport1.png, /images/k8s-nodeport1.png 1.5x, /images/k8s-nodeport1.png 2x"
        data-sizes="auto"
        alt="/images/k8s-nodeport1.png"
        title="/images/k8s-nodeport1.png" /></p>
<p>Kubernetes sets up a cluster IP address, the same as if you had requested a Service of <code>type: ClusterIP</code> (10.106.1.12)</p>
<ul>
<li>To connect the service to the pod, use selector</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">30008</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">front-end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">front-end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>service.spec.selector must be equal to pod.metadata.labels</strong> to connect each other.</p>
<h4 id="how-do-i-verify-if-the-nodeport-service-and-the-pod-are-properly-connected">How do I verify if the NodePort service and the pod are properly connected?</h4>
<blockquote>
<p>To confirm whether the service and the pod are properly connected, we can check the endpoints via the service describe as shown below, and then compare them with the IP of the pod.</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/nodeport-with-pod.png"
        data-srcset="/images/nodeport-with-pod.png, /images/nodeport-with-pod.png 1.5x, /images/nodeport-with-pod.png 2x"
        data-sizes="auto"
        alt="/images/nodeport-with-pod.png"
        title="/images/nodeport-with-pod.png" /></p>
<h4 id="a-service-with-multipe-pods-with-single-service">A service with multipe pods with single service</h4>
<ul>
<li>Random algorithm is used to balance the load of traffic</li>
<li>Session Affinity: yes in this case</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/multi_pod_nodeport.png"
        data-srcset="/images/multi_pod_nodeport.png, /images/multi_pod_nodeport.png 1.5x, /images/multi_pod_nodeport.png 2x"
        data-sizes="auto"
        alt="/images/multi_pod_nodeport.png"
        title="/images/multi_pod_nodeport.png" /></p>
<h4 id="when-pods-are-distributed-across-multiple-nodes">When pods are distributed across multiple nodes</h4>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/multi_node_nodeport.png"
        data-srcset="/images/multi_node_nodeport.png, /images/multi_node_nodeport.png 1.5x, /images/multi_node_nodeport.png 2x"
        data-sizes="auto"
        alt="/images/multi_node_nodeport.png"
        title="/images/multi_node_nodeport.png" /></p>
<p>Let&rsquo;s look at what happens when the Pods are distributed across multiple nodes. In this case, we have the web application on Pods on separate nodes in the cluster, When we create a service, without having to do any additional configuration.</p>
<p>Kubernetes automatically creates a service that spans <strong>across all the nodes in the cluster</strong> and <strong>maps the target port to the same node port on all the nodes in the cluster.</strong></p>
<p><strong>This way you can access your application using the IP of any node in the cluster and using the same port number which in this case is 30,008.</strong> As you can see, using the IP of any of these nodes, and I&rsquo;m trying to curl to the same port, and the same port is made available on all the nodes part of the cluster.</p>
<h4 id="clusterip">ClusterIP</h4>
<ul>
<li>The service creates a <strong>Virtual IP</strong> inside the cluster to enable communication between different services such as a set of frontend servers to a set of backend servers.</li>
<li><strong>A kubernetes service can help us group the pods together and provide a single interface to access the pod in a group.</strong></li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s_clusterip.png"
        data-srcset="/images/k8s_clusterip.png, /images/k8s_clusterip.png 1.5x, /images/k8s_clusterip.png 2x"
        data-sizes="auto"
        alt="/images/k8s_clusterip.png"
        title="/images/k8s_clusterip.png" /></p>
<h4 id="loadbalancer">LoadBalancer</h4>
<p>Where the service provisions a loadbalancer for our application in supported cloud providers.</p>
<h2 id="namespaces">Namespaces</h2>
<p>In k8s, namespaces provide a mechanism for <strong>isolating groups of resources</strong> within a single cluster. Names of resoures need to be unique within a namespace, but not across namespaces.</p>
<blockquote>
<p>This means that when we have namespaces such as (dev, sandbox, prod), then we can generate golang backend pods for each environment respectively(accordingly).</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-namespace-isolation.png"
        data-srcset="/images/k8s-namespace-isolation.png, /images/k8s-namespace-isolation.png 1.5x, /images/k8s-namespace-isolation.png 2x"
        data-sizes="auto"
        alt="/images/k8s-namespace-isolation.png"
        title="/images/k8s-namespace-isolation.png" /></p>
<h4 id="namespace-cli">namespace cli</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">get</span> <span class="n">ns</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>              <span class="n">STATUS</span>   <span class="n">AGE</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">system</span>       <span class="n">Active</span>   <span class="mi">9</span><span class="n">m56s</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">public</span>       <span class="n">Active</span>   <span class="mi">9</span><span class="n">m56s</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">lease</span>   <span class="n">Active</span>   <span class="mi">9</span><span class="n">m56s</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>           <span class="n">Active</span>   <span class="mi">9</span><span class="n">m56s</span>
</span></span><span class="line"><span class="cl"><span class="n">finance</span>           <span class="n">Active</span>   <span class="mi">22</span><span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">marketing</span>         <span class="n">Active</span>   <span class="mi">22</span><span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">dev</span>               <span class="n">Active</span>   <span class="mi">21</span><span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">prod</span>              <span class="n">Active</span>   <span class="mi">21</span><span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">manufacturing</span>     <span class="n">Active</span>   <span class="mi">21</span><span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">research</span>          <span class="n">Active</span>   <span class="mi">21</span><span class="n">s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">get</span> <span class="n">ns</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">headers</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
</span></span><span class="line"><span class="cl"><span class="mi">10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">get</span> <span class="n">po</span> <span class="o">-</span><span class="n">n</span><span class="o">=</span><span class="n">research</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">headers</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># create and run pod with finance namespace</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 생각해보니까 apply, create으로 pod 직접적으로 만들지 않았던 것 같네. 곧바로 run 했던 것 같은데, run = create + run like docker</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">run</span> <span class="n">redis</span> <span class="o">-</span><span class="n">n</span><span class="o">=</span><span class="n">finance</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">redis</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># swich ns</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">kubectl</span> <span class="n">config</span> <span class="nb">set</span><span class="o">-</span><span class="n">context</span> <span class="err">$</span><span class="p">(</span><span class="n">kubectl</span> <span class="n">config</span> <span class="n">current</span><span class="o">-</span><span class="n">context</span><span class="p">)</span> <span class="o">--</span><span class="n">namespace</span><span class="o">=</span><span class="n">dev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># view pods in all namespace</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">kubectl</span> <span class="n">get</span> <span class="n">pods</span> <span class="o">--</span><span class="nb">all</span><span class="o">-</span><span class="n">namespaces</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="kubernetes-dns-rule">kubernetes DNS rule</h4>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s_dns_rule.png"
        data-srcset="/images/k8s_dns_rule.png, /images/k8s_dns_rule.png 1.5x, /images/k8s_dns_rule.png 2x"
        data-sizes="auto"
        alt="/images/k8s_dns_rule.png"
        title="/images/k8s_dns_rule.png" /></p>
<ul>
<li>
<p>&lt;Service_Name&gt;.<Namespace>.svc.cluster.local</p>
</li>
<li>
<p>same namespace: just use service name</p>
</li>
<li>
<p>another namespace: db-service.dev.svc.cluster.local</p>
</li>
</ul>
<h4 id="deterministic-namespace">deterministic namespace</h4>
<ul>
<li>If you want to make sure that this pod gets you created in the dev env all the time, even if you don&rsquo;t specify in the command line, you can move the &ndash;namespace definition into the pod-definition file.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># or $ kubectl create -f pod-definition.yaml --namespace=dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">myapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">front-end</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="resourcequota">ResourceQuota</h4>
<ul>
<li>To limit resources in a namespace, create a resource quota. To create one start with ResourceQuota definition file.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s_ns_resource_quota.png"
        data-srcset="/images/k8s_ns_resource_quota.png, /images/k8s_ns_resource_quota.png 1.5x, /images/k8s_ns_resource_quota.png 2x"
        data-sizes="auto"
        alt="/images/k8s_ns_resource_quota.png"
        title="/images/k8s_ns_resource_quota.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ResourceQuota</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">compute-quota</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hard</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pods</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">requests.cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;4&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">requests.memory</span><span class="p">:</span><span class="w"> </span><span class="l">5Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">limits.cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">limits.memory</span><span class="p">:</span><span class="w"> </span><span class="l">10Gi</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="imperative">Imperative</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">run</span> <span class="n">nginx</span><span class="o">-</span><span class="n">pod</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">nginx</span><span class="p">:</span><span class="n">alpine</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">run</span> <span class="n">redis</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">redis</span><span class="p">:</span><span class="n">alpine</span> <span class="o">--</span><span class="n">labels</span><span class="o">=</span><span class="s2">&#34;tier=db&#34;</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">expose</span> <span class="n">po</span> <span class="n">redis</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="mi">6379</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">redis</span><span class="o">-</span><span class="n">service</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">create</span> <span class="n">deploy</span> <span class="n">webapp</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">kodekloud</span><span class="o">/</span><span class="n">webapp</span><span class="o">-</span><span class="n">color</span> <span class="o">--</span><span class="n">replicas</span><span class="o">=</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">run</span> <span class="n">custom</span><span class="o">-</span><span class="n">nginx</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">nginx</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="mi">8080</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">create</span> <span class="n">ns</span> <span class="n">dev</span><span class="o">-</span><span class="n">ns</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">create</span> <span class="n">deploy</span> <span class="n">redis</span><span class="o">-</span><span class="n">deploy</span> <span class="o">-</span><span class="n">n</span> <span class="n">dev</span><span class="o">-</span><span class="n">ns</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">redis</span> <span class="o">--</span><span class="n">replicas</span><span class="o">=</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">run</span> <span class="n">httpd</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">httpd</span><span class="p">:</span><span class="n">alpine</span> <span class="o">&amp;&amp;</span> <span class="n">k</span> <span class="n">expose</span> <span class="n">po</span> <span class="n">httpd</span> <span class="o">--</span><span class="n">port</span><span class="o">=</span><span class="mi">80</span> <span class="o">--</span><span class="n">name</span><span class="o">=</span><span class="n">httpd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="chapter-3-schedule">Chapter 3: Schedule</h1>
<h2 id="manual-schduling">Manual schduling</h2>
<ul>
<li>Schduler bind pod to nodes</li>
<li>If there is no scheduler, pod&rsquo;s status would be &lsquo;Pending&rsquo;</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>when there is scheduler</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">floe</span><span class="nd">@floe</span><span class="o">-</span><span class="n">QEMU</span><span class="o">-</span><span class="n">Virtual</span><span class="o">-</span><span class="n">Machine</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">k</span> <span class="n">get</span> <span class="n">po</span> <span class="o">-</span><span class="n">o</span> <span class="n">wide</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>    <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>   <span class="n">IP</span>            <span class="n">NODE</span>       <span class="n">NOMINATED</span> <span class="n">NODE</span>   <span class="n">READINESS</span> <span class="n">GATES</span>
</span></span><span class="line"><span class="cl"><span class="n">nginx</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">40</span><span class="n">s</span>   <span class="mf">10.244.0.14</span>   <span class="n">minikube</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">floe</span><span class="nd">@floe</span><span class="o">-</span><span class="n">QEMU</span><span class="o">-</span><span class="n">Virtual</span><span class="o">-</span><span class="n">Machine</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">k</span> <span class="n">get</span> <span class="n">nodes</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>       <span class="n">STATUS</span>   <span class="n">ROLES</span>           <span class="n">AGE</span>     <span class="n">VERSION</span>
</span></span><span class="line"><span class="cl"><span class="n">minikube</span>   <span class="n">Ready</span>    <span class="n">control</span><span class="o">-</span><span class="n">plane</span>   <span class="mi">5</span><span class="n">d19h</span>   <span class="n">v1</span><span class="mf">.28.3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>When there is no scheduler, there would be empty Node value on pod description.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># There is no aligned node to the pod.</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">describe</span> <span class="n">po</span> <span class="n">nginx</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">Node</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># There is no scheduler.</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">get</span> <span class="n">po</span> <span class="o">-</span><span class="n">n</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">scheduler</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># get nodes</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">get</span> <span class="n">nodes</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Then, if we want to manually scheule our pod, write nodeName to pod yaml</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">nodeName</span><span class="p">:</span><span class="w"> </span><span class="l">node02</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>After that delete and replace our pod resource to schedule on node02</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># kill pod and replace resource</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">replace</span> <span class="o">--</span><span class="n">force</span> <span class="o">-</span><span class="n">f</span> <span class="n">nginx</span><span class="o">.</span><span class="n">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="labels-and-selectors">Labels and Selectors</h2>
<ul>
<li>Labels are key/value pairs that are attached to objects such as Pods
<ul>
<li>Unlike names and UIDS, labels do not provide uniqueness. In general, we expect many objects to carry the same labels.</li>
</ul>
</li>
<li>Via a label selector, the client/user can identify a set of objects. The label selector is the core grouping primitive in Kubernetes.</li>
</ul>
<h2 id="taints-and-tolerations">Taints and Tolerations</h2>
<ul>
<li>Node affinity: a property of Pods that attracts them to a set of nodes (either as a preference or a hard requirement).</li>
<li>Taints: Taints are the opposite &ndash; they allow a <strong>node</strong> to repel(격퇴하다) a set of pods.</li>
<li>Tolerations: <strong>Tolerations are applied to pods</strong>. Tolerations allow the scheduler to schedule pods with matching taints.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">kubectl</span> <span class="n">taint</span> <span class="n">nodes</span> <span class="n">node1</span> <span class="n">key1</span><span class="o">=</span><span class="n">value1</span><span class="p">:</span><span class="n">NoExecute</span>
</span></span><span class="line"><span class="cl"><span class="n">kubectl</span> <span class="n">taint</span> <span class="n">nodes</span> <span class="n">node1</span> <span class="n">key1</span><span class="o">=</span><span class="n">value1</span><span class="p">:</span><span class="n">NoSchedule</span>
</span></span><span class="line"><span class="cl"><span class="n">kubectl</span> <span class="n">taint</span> <span class="n">nodes</span> <span class="n">node1</span> <span class="n">key1</span><span class="o">=</span><span class="n">value1</span><span class="p">:</span><span class="n">PreferNoSchedule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Taint Effect fields</p>
<ul>
<li><code>NoExecute</code>
<ul>
<li>Pods that do not tolerate the taint are evicted immediately</li>
<li>Pods that tolerate the taint without specifying tolerationSeconds in their toleration specification remain bound forever</li>
</ul>
</li>
<li><code>NoSchedule</code>
<ul>
<li>No new pods will be scheduled unless matching toleration (key1=value1)</li>
<li>Pods currently running on the node are not evicted.</li>
</ul>
</li>
<li><code>PreferNoSchedule</code>
<ul>
<li>soft version of NoSchedule. The control plane will try to avoid but not guaranteed.</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># Create a taint on node01 with key of spray, value of mortein and effect of NoSchedule
</span></span><span class="line"><span class="cl">k taint nodes node01 spray=mortein:NoSchedule
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="node-affinity">Node affinity</h2>
<p>he primary feature of Node Affinity is to ensure that the pods are hosted on particular nodes.</p>
<ul>
<li>With Node Selectors we cannot provide the advance expressions.
<ul>
<li>e.g. A OR B, NOT A</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myapp-pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">data-processor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">data-processor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">affinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nodeAffinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">requireDuringScedulingIgnoredDuringExecution</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">size</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">opeator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">values</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Large</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Medium</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="node-affinity-types">Node Affinity Types</h3>
<blockquote>
<p><a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#types-of-inter-pod-affinity-and-anti-affinity" target="_blank" rel="noopener noreffer">https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#types-of-inter-pod-affinity-and-anti-affinity</a>
</p>
</blockquote>
<ul>
<li>
<p>Available</p>
<ul>
<li>requiredDuringSchedulingIgnoredDuringExecution</li>
<li>preferredDuringSchedulingIgnoredDuringExecution</li>
</ul>
</li>
<li>
<p>Future plan</p>
<ul>
<li>double require: requiredDuringSchedulingRequiredDuringExecution</li>
<li>prefer require: preferredDuringSchedulingRequiredDuringExecution</li>
</ul>
</li>
</ul>
<p>Wrap up the available node affinity types states</p>
<ul>
<li><strong>DuringScheduling: Required | Preferred</strong></li>
<li><strong>DuringExecution: Ignored</strong></li>
</ul>
<h2 id="taints-and-tolerations-and-node-affinity">Taints and tolerations and Node Affinity</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-na.PNG?raw=true"
        data-srcset="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-na.PNG?raw=true, https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-na.PNG?raw=true 1.5x, https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-na.PNG?raw=true 2x"
        data-sizes="auto"
        alt="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-na.PNG?raw=true"
        title="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-na.PNG?raw=true" /></p>
<p>The combination of Taint + Tolearation can block other pod to be scheduled on tainted node, but cannot ensure that tolearated pod are being placed on the matching tainted node. so if that case we need affinity</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-nsa.png?raw=true"
        data-srcset="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-nsa.png?raw=true, https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-nsa.png?raw=true 1.5x, https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-nsa.png?raw=true 2x"
        data-sizes="auto"
        alt="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-nsa.png?raw=true"
        title="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/blob/master/images/tn-nsa.png?raw=true" /></p>
<p>As such, a combination of taints and tolerations and node affinity rules can be used together to completely dedicate nodes for specific parts.</p>
<h2 id="cli">cli</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># Open terminal output with vim to easily find `/` N/n</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">k</span> <span class="n">describe</span> <span class="n">no</span> <span class="n">node01</span> <span class="o">|</span> <span class="n">vim</span> <span class="o">-</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">k</span> <span class="n">get</span> <span class="n">no</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">headers</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># set label to node</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">label</span> <span class="n">no</span> <span class="n">node01</span> <span class="n">color</span><span class="o">=</span><span class="n">blue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">create</span> <span class="n">deploy</span> <span class="n">blue</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">nginx</span> <span class="o">--</span><span class="n">replicas</span><span class="o">=</span><span class="mi">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">describe</span> <span class="n">no</span> <span class="n">controlplane</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">taints</span>
</span></span><span class="line"><span class="cl"><span class="n">Taints</span><span class="p">:</span>             <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">describe</span> <span class="n">no</span> <span class="n">node01</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">taints</span>
</span></span><span class="line"><span class="cl"><span class="n">Taints</span><span class="p">:</span>             <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">k</span> <span class="n">describe</span> <span class="n">no</span> <span class="n">controlplane</span> 
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span>               <span class="n">controlplane</span>
</span></span><span class="line"><span class="cl"><span class="n">Roles</span><span class="p">:</span>              <span class="n">control</span><span class="o">-</span><span class="n">plane</span>
</span></span><span class="line"><span class="cl"><span class="n">Labels</span><span class="p">:</span>             <span class="n">beta</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">arch</span><span class="o">=</span><span class="n">amd64</span>
</span></span><span class="line"><span class="cl">                    <span class="n">beta</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">os</span><span class="o">=</span><span class="n">linux</span>
</span></span><span class="line"><span class="cl">                    <span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">arch</span><span class="o">=</span><span class="n">amd64</span>
</span></span><span class="line"><span class="cl">                    <span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">hostname</span><span class="o">=</span><span class="n">controlplane</span>
</span></span><span class="line"><span class="cl">                    <span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">os</span><span class="o">=</span><span class="n">linux</span>
</span></span><span class="line"><span class="cl">                    <span class="n">node</span><span class="o">-</span><span class="n">role</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">control</span><span class="o">-</span><span class="n">plane</span><span class="o">=</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>label exists operator</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">red</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">red</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">red</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">red</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">affinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">nodeAffinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">node-role.kubernetes.io/control-plane</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">Exists</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="resource-and-limit">Resource and Limit</h2>
<ul>
<li>If the node where a Pod is running has enough of a resource available, it&rsquo;s possible (and allowed) for a container to use more resource than its request for that resource specifies.</li>
<li>However, a container is not allowed to use more than its resource limit.</li>
<li>Kubelet and container runtime enforce the limit.</li>
</ul>
<h3 id="limit-cpu-vs-limit-memory">Limit cpu vs Limit memory</h3>
<ul>
<li>memory: oom kill</li>
<li>cpu: throttle</li>
</ul>
<h4 id="memory"><strong>memory</strong></h4>
<blockquote>
<p><a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/" target="_blank" rel="noopener noreffer">when a process in the container tries to consume more than the allowed amount of memory, the system kernel terminates the process that attempted the allocation, <strong>with an out of memory (OOM) error</strong>.</a>
</p>
</blockquote>
<h4 id="cpu"><strong>cpu</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cpu-demo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">cpu-example</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cpu-demo-ctr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">vish/stress</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.5&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- -<span class="l">cpus</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;2&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/" target="_blank" rel="noopener noreffer">Configured the Container to attempt to use 2 CPUs, but the Container is only being allowed to use about 1 CPU. The container&rsquo;s CPU use is being <strong>throttled</strong>, because the container is attempting to use more CPU resources than its limit.</a>
</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/resource_limit_cpu_memory.png"
        data-srcset="/images/resource_limit_cpu_memory.png, /images/resource_limit_cpu_memory.png 1.5x, /images/resource_limit_cpu_memory.png 2x"
        data-sizes="auto"
        alt="/images/resource_limit_cpu_memory.png"
        title="/images/resource_limit_cpu_memory.png" /></p>
<ul>
<li>CPU: Request and No Limit is ideal</li>
</ul>
<h2 id="daemon-sets">Daemon Sets</h2>
<p>A DaemonSet ensures that all or some Nodes run a copy of a Pod.</p>
<ul>
<li>As nodes are added to the cluster, Pods are added to them</li>
<li>As nodes are removed from the cluster, those Pods are garbage collected</li>
</ul>
<p>Some typical use of a DaemonSet are:</p>
<ul>
<li>running a cluster storage daemon on every node</li>
<li>running a logs collection daemon on every node</li>
<li>running a node monitoring daemon on every node</li>
</ul>
<p>Also kube-proxy componenet can be deployed as DaemonSets</p>
<h3 id="how-to-create">How to create?</h3>
<ol>
<li>first create deployment &ndash;dry-run=client -o yaml &gt; ds.yaml</li>
<li>delete status / replicas</li>
<li>and</li>
</ol>
<h2 id="static-pods">Static pods</h2>
<blockquote>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/" target="_blank" rel="noopener noreffer">https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/</a>
</p>
</blockquote>
<p>Static Pods are managed directly by the kubelt daemon on a specific node without the <code>kube-apiserver</code> observing them. Unlike Pods that are managed by the control plane(etcd, api, scheduler, controller manager ..); instead, the kubelet watches each static Pod.</p>
<ul>
<li>Static Pods are always bound to one Kubelt on a specific node.</li>
<li>The kubelet automatically tries to create a mirror Pod on the kube-apiserver for each static Pod.</li>
<li>This means static pods running on a node are visible on the API server, but cannot be controlled from there.</li>
</ul>
<blockquote>
<p>Mirror pod? A pod object that a kubelt uses to represent a static pod</p>
</blockquote>
<ul>
<li><strong>Kubelet only can understand pod level</strong></li>
</ul>
<h4 id="use-case">Use Case</h4>
<ul>
<li>kubeadm: Deploy control plane component as static Pods
<ul>
<li>kubeadm은 kubelet을 통해 <code>/etc/kubernetest/manifests</code> 안에 있는 control plane  component spec을 읽어 static pods들을 생성하여 관리한다.</li>
</ul>
</li>
<li>edge computing (iot)</li>
</ul>
<h4 id="check-wheter-pod-is-static-or-not">Check wheter pod is static or not</h4>
<p>There is two way</p>
<ol>
<li>k get nodes &amp;&amp; k get po -A</li>
</ol>
<ul>
<li>static pod naming: [POD NAME]-[NODE NAME]</li>
</ul>
<ol start="2">
<li>k describe po [POD NAME] and check Owner: Node or other resource types</li>
</ol>
<h4 id="how-to-find-staticpodpath">How to find staticPodPath</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">ps</span> <span class="o">-</span><span class="n">aux</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">kubelet</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span>        <span class="mi">4351</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span> <span class="mi">4519680</span> <span class="mi">100556</span> <span class="err">?</span>      <span class="n">Ssl</span>  <span class="mi">02</span><span class="p">:</span><span class="mi">23</span>   <span class="mi">0</span><span class="p">:</span><span class="mi">36</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">kubelet</span> <span class="o">--</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">kubeconfig</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">kubelet</span><span class="o">.</span><span class="n">conf</span> <span class="o">--</span><span class="n">kubeconfig</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">kubelet</span><span class="o">.</span><span class="n">conf</span> <span class="o">--</span><span class="n">config</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kubelet</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">container</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="n">endpoint</span><span class="o">=</span><span class="n">unix</span><span class="p">:</span><span class="o">///</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">containerd</span><span class="o">/</span><span class="n">containerd</span><span class="o">.</span><span class="n">sock</span> <span class="o">--</span><span class="n">pod</span><span class="o">-</span><span class="n">infra</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">image</span><span class="o">=</span><span class="n">registry</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">pause</span><span class="p">:</span><span class="mf">3.9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cat</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kubelet</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">staticPodPath</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="how-to-create-staticpod">How to create staticPod</h3>
<blockquote>
<p>Create a static pod named static-busybox that uses the busybox image and the command sleep 1000</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">run</span> <span class="n">static</span><span class="o">-</span><span class="n">busybox</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">busybox</span> <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span><span class="o">=</span><span class="n">client</span> <span class="o">-</span><span class="n">o</span> <span class="n">yaml</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">manifests</span><span class="o">/</span><span class="n">static</span><span class="o">-</span><span class="n">busybox</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">manifests</span><span class="o">/</span><span class="n">static</span><span class="o">-</span><span class="n">busybox</span><span class="o">.</span><span class="n">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">static-busybox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">static-busybox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">busybox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">static-busybox</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;sleep&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;1000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">dnsPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterFirst</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="how-to-find-staticpod-and-delete-it">How to find staticPod and delete it</h3>
<blockquote>
<p>Question: We just created a new static pod named static-greenbox. Find it and delete it.</p>
<blockquote>
<p>This question is a bit tricky. But if you use the knowledge you gained in the previous questions in this lab, you should be able to find the answer to it.</p>
</blockquote>
</blockquote>
<ol>
<li>First, let&rsquo;s identify the node in which the pod called static-greenbox is created. To do this, run:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@controlplane</span><span class="p">:</span><span class="o">~</span><span class="c1"># kubectl get pods --all-namespaces -o wide  | grep static-greenbox</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>       <span class="n">static</span><span class="o">-</span><span class="n">greenbox</span><span class="o">-</span><span class="n">node01</span>                 <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">19</span><span class="n">s</span>     <span class="mf">10.244.1.2</span>   <span class="n">node01</span>       <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@controlplane</span><span class="p">:</span><span class="o">~</span><span class="c1">#</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>From the result of this command, we can see that the pod is running on node01.</p>
<ol start="2">
<li>Next, SSH to node01 and identify the path configured for static pods in this node.</li>
</ol>
<ul>
<li>Important: The path need not be /etc/kubernetes/manifests. Make sure to check the path configured in the kubelet configuration file.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@controlplane</span><span class="p">:</span><span class="o">~</span><span class="c1"># ssh node01 </span>
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@node01</span><span class="p">:</span><span class="o">~</span><span class="c1"># ps -ef |  grep /usr/bin/kubelet </span>
</span></span><span class="line"><span class="cl"><span class="n">root</span>        <span class="mi">4147</span>       <span class="mi">1</span>  <span class="mi">0</span> <span class="mi">14</span><span class="p">:</span><span class="mi">05</span> <span class="err">?</span>        <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">kubelet</span> <span class="o">--</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">kubeconfig</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">bootstrap</span><span class="o">-</span><span class="n">kubelet</span><span class="o">.</span><span class="n">conf</span> <span class="o">--</span><span class="n">kubeconfig</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">kubelet</span><span class="o">.</span><span class="n">conf</span> <span class="o">--</span><span class="n">config</span><span class="o">=/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">kubelet</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">container</span><span class="o">-</span><span class="n">runtime</span><span class="o">-</span><span class="n">endpoint</span><span class="o">=</span><span class="n">unix</span><span class="p">:</span><span class="o">///</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">containerd</span><span class="o">/</span><span class="n">containerd</span><span class="o">.</span><span class="n">sock</span> <span class="o">--</span><span class="n">pod</span><span class="o">-</span><span class="n">infra</span><span class="o">-</span><span class="n">container</span><span class="o">-</span><span class="n">image</span><span class="o">=</span><span class="n">registry</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">pause</span><span class="p">:</span><span class="mf">3.9</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span>        <span class="mi">4773</span>    <span class="mi">4733</span>  <span class="mi">0</span> <span class="mi">14</span><span class="p">:</span><span class="mi">05</span> <span class="n">pts</span><span class="o">/</span><span class="mi">0</span>    <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">grep</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">kubelet</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@node01</span><span class="p">:</span><span class="o">~</span><span class="c1"># grep -i staticpod /var/lib/kubelet/config.yaml</span>
</span></span><span class="line"><span class="cl"><span class="n">staticPodPath</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">just</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">mess</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">you</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@node01</span><span class="p">:</span><span class="o">~</span><span class="c1"># </span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here the staticPodPath is /etc/just-to-mess-with-you</p>
<ol start="3">
<li>Navigate to this directory and delete the YAML file:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@node01</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">just</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">mess</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">you</span><span class="c1"># ls</span>
</span></span><span class="line"><span class="cl"><span class="n">greenbox</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@node01</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">just</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">mess</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">you</span><span class="c1"># rm -rf greenbox.yaml </span>
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@node01</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">just</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">mess</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">you</span><span class="c1">#</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>Exit out of node01 using CTRL + D or type exit. You should return to the controlplane node. Check if the static-greenbox pod has been deleted:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@controlplane</span><span class="p">:</span><span class="o">~</span><span class="c1"># kubectl get pods --all-namespaces -o wide  | grep static-greenbox</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@controlplane</span><span class="p">:</span><span class="o">~</span><span class="c1"># </span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="chapter-5-application-lifecycle-management">Chapter 5: Application Lifecycle Management</h1>
<h2 id="configmap">Configmap</h2>
<ul>
<li>Note that not to use <code>--from-file</code>, this is only handle single key like <code>--from-literal</code></li>
<li>Instead use <code>k create cm &lt;NAME&gt; --from-env-file=</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">vim</span> <span class="n">webapp</span><span class="o">.</span><span class="n">env</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">create</span> <span class="n">cm</span> <span class="n">webapp</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="nb">map</span> <span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">env</span><span class="o">-</span><span class="n">file</span><span class="o">=./</span><span class="n">webapp</span><span class="o">.</span><span class="n">env</span>
</span></span><span class="line"><span class="cl"><span class="n">configmap</span><span class="o">/</span><span class="n">webapp</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="nb">map</span> <span class="n">created</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="secret">Secret</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">k</span> <span class="n">create</span> <span class="n">secret</span> <span class="n">generic</span> <span class="n">db</span><span class="o">-</span><span class="n">secret</span> <span class="o">--</span><span class="n">from</span><span class="o">-</span><span class="n">env</span><span class="o">-</span><span class="n">file</span><span class="o">=./</span><span class="n">db</span><span class="o">.</span><span class="n">env</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>envFrom</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">envfrom-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">envars-test-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">envFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">secretRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">test-secret</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h1 id="chapter-6-cluster-maintenance">Chapter 6: Cluster Maintenance</h1>
<h2 id="node-upgrade-os-upgrade">Node upgrade (OS upgrade)</h2>
<ul>
<li>drain: cordon + move resources</li>
<li>uncordon: node ensable to be scheduled</li>
<li>cordon: node disable to be scheduled</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">//</span> <span class="n">Move</span> <span class="n">every</span> <span class="n">resources</span> <span class="kn">from</span> <span class="nn">node</span><span class="o">-</span><span class="mi">1</span> <span class="n">to</span> <span class="n">others</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">drain</span> <span class="n">node</span><span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="n">after</span> <span class="n">node</span> <span class="n">upgrade</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="n">cordon</span><span class="p">:</span> <span class="n">block</span> <span class="n">node</span> <span class="kn">from</span> <span class="nn">scheduling</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="n">uncordon</span><span class="p">:</span> <span class="n">enable</span> <span class="n">scheduling</span> <span class="n">back</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">uncordon</span> <span class="n">node</span><span class="o">-</span><span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Running the uncordon command on a node will not automatically schedule pods on the node. When new pods are created, they will be placed on node01.</p>
<blockquote>
<p>We will be upgrading the controlplane node first. Drain the controlplane node of workloads and mark it UnSchedulable</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">k</span> <span class="n">drain</span> <span class="n">node01</span> <span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">daemonsets</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span><span class="o">/</span><span class="n">node01</span> <span class="n">cordoned</span>
</span></span><span class="line"><span class="cl"><span class="ne">Warning</span><span class="p">:</span> <span class="n">ignoring</span> <span class="n">DaemonSet</span><span class="o">-</span><span class="n">managed</span> <span class="n">Pods</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">-</span><span class="n">ds</span><span class="o">-</span><span class="n">rp464</span><span class="p">,</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="mi">8</span><span class="n">gmv5</span>
</span></span><span class="line"><span class="cl"><span class="n">evicting</span> <span class="n">pod</span> <span class="n">default</span><span class="o">/</span><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">qm6x9</span>
</span></span><span class="line"><span class="cl"><span class="n">evicting</span> <span class="n">pod</span> <span class="n">default</span><span class="o">/</span><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">hbzk9</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="o">/</span><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">hbzk9</span> <span class="n">evicted</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="o">/</span><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">qm6x9</span> <span class="n">evicted</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span><span class="o">/</span><span class="n">node01</span> <span class="n">drained</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>There are daemonsets created in this cluster, especially in the kube-system namespace. To ignore these objects and drain the node, we can make use of the &ndash;ignore-daemonsets flag.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">drain</span> <span class="n">node01</span> <span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">daemonsets</span> <span class="o">--</span><span class="n">force</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span><span class="o">/</span><span class="n">node01</span> <span class="n">already</span> <span class="n">cordoned</span>
</span></span><span class="line"><span class="cl"><span class="ne">Warning</span><span class="p">:</span> <span class="n">deleting</span> <span class="n">Pods</span> <span class="n">that</span> <span class="n">declare</span> <span class="n">no</span> <span class="n">controller</span><span class="p">:</span> <span class="n">default</span><span class="o">/</span><span class="n">hr</span><span class="o">-</span><span class="n">app</span><span class="p">;</span> <span class="n">ignoring</span> <span class="n">DaemonSet</span><span class="o">-</span><span class="n">managed</span> <span class="n">Pods</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">-</span><span class="n">ds</span><span class="o">-</span><span class="n">rp464</span><span class="p">,</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="mi">8</span><span class="n">gmv5</span>
</span></span><span class="line"><span class="cl"><span class="n">evicting</span> <span class="n">pod</span> <span class="n">default</span><span class="o">/</span><span class="n">hr</span><span class="o">-</span><span class="n">app</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Question&hellip; I&rsquo;m just curious that why there&rsquo;s still pod on drained node</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">drain</span> <span class="n">controlplane</span> <span class="o">--</span><span class="n">ignore</span><span class="o">-</span><span class="n">daemonsets</span> 
</span></span><span class="line"><span class="cl"><span class="n">node</span><span class="o">/</span><span class="n">controlplane</span> <span class="n">cordoned</span>
</span></span><span class="line"><span class="cl"><span class="ne">Warning</span><span class="p">:</span> <span class="n">ignoring</span> <span class="n">DaemonSet</span><span class="o">-</span><span class="n">managed</span> <span class="n">Pods</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">-</span><span class="n">ds</span><span class="o">-</span><span class="mi">9</span><span class="n">wfn6</span><span class="p">,</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="n">x5qj8</span>
</span></span><span class="line"><span class="cl"><span class="n">evicting</span> <span class="n">pod</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span><span class="o">/</span><span class="n">coredns</span><span class="o">-</span><span class="mi">5</span><span class="n">dd5756b68</span><span class="o">-</span><span class="n">l5w24</span>
</span></span><span class="line"><span class="cl"><span class="n">evicting</span> <span class="n">pod</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span><span class="o">/</span><span class="n">coredns</span><span class="o">-</span><span class="mi">5</span><span class="n">dd5756b68</span><span class="o">-</span><span class="mi">5</span><span class="n">nbck</span>
</span></span><span class="line"><span class="cl"><span class="n">evicting</span> <span class="n">pod</span> <span class="n">default</span><span class="o">/</span><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">pxxm6</span>
</span></span><span class="line"><span class="cl"><span class="n">evicting</span> <span class="n">pod</span> <span class="n">default</span><span class="o">/</span><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">m72qc</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="o">/</span><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">m72qc</span> <span class="n">evicted</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="o">/</span><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">pxxm6</span> <span class="n">evicted</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="o">/</span><span class="n">coredns</span><span class="o">-</span><span class="mi">5</span><span class="n">dd5756b68</span><span class="o">-</span><span class="mi">5</span><span class="n">nbck</span> <span class="n">evicted</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="o">/</span><span class="n">coredns</span><span class="o">-</span><span class="mi">5</span><span class="n">dd5756b68</span><span class="o">-</span><span class="n">l5w24</span> <span class="n">evicted</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span><span class="o">/</span><span class="n">controlplane</span> <span class="n">drained</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">get</span> <span class="n">no</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>           <span class="n">STATUS</span>                     <span class="n">ROLES</span>           <span class="n">AGE</span>   <span class="n">VERSION</span>
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span>   <span class="n">Ready</span><span class="p">,</span><span class="n">SchedulingDisabled</span>   <span class="n">control</span><span class="o">-</span><span class="n">plane</span>   <span class="mi">29</span><span class="n">m</span>   <span class="n">v1</span><span class="mf">.28.0</span>
</span></span><span class="line"><span class="cl"><span class="n">node01</span>         <span class="n">Ready</span>                      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>          <span class="mi">29</span><span class="n">m</span>   <span class="n">v1</span><span class="mf">.28.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">get</span> <span class="n">po</span> <span class="o">-</span><span class="n">o</span> <span class="n">wide</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>                    <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>     <span class="n">IP</span>            <span class="n">NODE</span>     <span class="n">NOMINATED</span> <span class="n">NODE</span>   <span class="n">READINESS</span> <span class="n">GATES</span>
</span></span><span class="line"><span class="cl"><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="mi">987</span><span class="n">gj</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">2</span><span class="n">m55s</span>   <span class="mf">10.244.1.4</span>    <span class="n">node01</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">bcdtn</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">2</span><span class="n">m55s</span>   <span class="mf">10.244.1.3</span>    <span class="n">node01</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">gnlz5</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">14</span><span class="n">s</span>     <span class="mf">10.244.1.10</span>   <span class="n">node01</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">lgbg4</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">14</span><span class="n">s</span>     <span class="mf">10.244.1.9</span>    <span class="n">node01</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">tfcj2</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">2</span><span class="n">m55s</span>   <span class="mf">10.244.1.2</span>    <span class="n">node01</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">get</span> <span class="n">po</span> <span class="o">-</span><span class="n">A</span> <span class="o">-</span><span class="n">o</span> <span class="n">wide</span>
</span></span><span class="line"><span class="cl"><span class="n">NAMESPACE</span>      <span class="n">NAME</span>                                   <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>    <span class="n">IP</span>            <span class="n">NODE</span>           <span class="n">NOMINATED</span> <span class="n">NODE</span>   <span class="n">READINESS</span> <span class="n">GATES</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>        <span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="mi">987</span><span class="n">gj</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">m2s</span>   <span class="mf">10.244.1.4</span>    <span class="n">node01</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>        <span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">bcdtn</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">m2s</span>   <span class="mf">10.244.1.3</span>    <span class="n">node01</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>        <span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">gnlz5</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">21</span><span class="n">s</span>    <span class="mf">10.244.1.10</span>   <span class="n">node01</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>        <span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">lgbg4</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">21</span><span class="n">s</span>    <span class="mf">10.244.1.9</span>    <span class="n">node01</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>        <span class="n">blue</span><span class="o">-</span><span class="mi">667</span><span class="n">bf6b9f9</span><span class="o">-</span><span class="n">tfcj2</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">3</span><span class="n">m2s</span>   <span class="mf">10.244.1.2</span>    <span class="n">node01</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">flannel</span>   <span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">-</span><span class="n">ds</span><span class="o">-</span><span class="mi">4</span><span class="n">krgp</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">29</span><span class="n">m</span>    <span class="mf">192.20.38.9</span>   <span class="n">node01</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">flannel</span>   <span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">-</span><span class="n">ds</span><span class="o">-</span><span class="mi">9</span><span class="n">wfn6</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">29</span><span class="n">m</span>    <span class="mf">192.20.38.6</span>   <span class="n">controlplane</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">system</span>    <span class="n">coredns</span><span class="o">-</span><span class="mi">5</span><span class="n">dd5756b68</span><span class="o">-</span><span class="mi">7</span><span class="n">dv8x</span>               <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">21</span><span class="n">s</span>    <span class="mf">10.244.1.8</span>    <span class="n">node01</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">system</span>    <span class="n">coredns</span><span class="o">-</span><span class="mi">5</span><span class="n">dd5756b68</span><span class="o">-</span><span class="n">ptnml</span>               <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">21</span><span class="n">s</span>    <span class="mf">10.244.1.11</span>   <span class="n">node01</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">system</span>    <span class="n">etcd</span><span class="o">-</span><span class="n">controlplane</span>                      <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">29</span><span class="n">m</span>    <span class="mf">192.20.38.6</span>   <span class="n">controlplane</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">system</span>    <span class="n">kube</span><span class="o">-</span><span class="n">apiserver</span><span class="o">-</span><span class="n">controlplane</span>            <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">29</span><span class="n">m</span>    <span class="mf">192.20.38.6</span>   <span class="n">controlplane</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">system</span>    <span class="n">kube</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">controlplane</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">29</span><span class="n">m</span>    <span class="mf">192.20.38.6</span>   <span class="n">controlplane</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">system</span>    <span class="n">kube</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="n">bwrl5</span>                       <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">29</span><span class="n">m</span>    <span class="mf">192.20.38.9</span>   <span class="n">node01</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">system</span>    <span class="n">kube</span><span class="o">-</span><span class="n">proxy</span><span class="o">-</span><span class="n">x5qj8</span>                       <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">29</span><span class="n">m</span>    <span class="mf">192.20.38.6</span>   <span class="n">controlplane</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">system</span>    <span class="n">kube</span><span class="o">-</span><span class="n">scheduler</span><span class="o">-</span><span class="n">controlplane</span>            <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">29</span><span class="n">m</span>    <span class="mf">192.20.38.6</span>   <span class="n">controlplane</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="kubernetes-software-versions">Kubernetes Software Versions</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># get kubectl version</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">version</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># get kubeadm upgrade plan</span>
</span></span><span class="line"><span class="cl"><span class="n">kubeadm</span> <span class="n">upgrade</span> <span class="n">plan</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can find all kubernetes releases at <a href="https://github.com/kubernetes/kubernetes/releases" target="_blank" rel="noopener noreffer">https://github.com/kubernetes/kubernetes/releases</a>
.
Downloaded package has all the kubernetes components in it except <code>ETCD cluster</code> and <code>CoreDNS</code> as they are seperate projects.</p>
<h2 id="cluster-upgrade-introduction">Cluster Upgrade Introduction</h2>
<blockquote>
<p>Q. Is it mandatory for all of the kubernetes components to have the same versions?</p>
</blockquote>
<p>No, The components can be at different release versions. At any time, <strong>kubernetes supports only up to the recent 3 minor versions</strong>, and the recommended approach is to upgrade one minor version at a time, instead of upgrading all 3 steps at once.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/raw/master/images/up2.PNG"
        data-srcset="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/raw/master/images/up2.PNG, https://github.com/kodekloudhub/certified-kubernetes-administrator-course/raw/master/images/up2.PNG 1.5x, https://github.com/kodekloudhub/certified-kubernetes-administrator-course/raw/master/images/up2.PNG 2x"
        data-sizes="auto"
        alt="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/raw/master/images/up2.PNG"
        title="https://github.com/kodekloudhub/certified-kubernetes-administrator-course/raw/master/images/up2.PNG" /></p>
<h2 id="upgrading-kubeadm-clusters">Upgrading kubeadm clusters</h2>
<blockquote>
<p><a href="https://v1-29.docs.kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/" target="_blank" rel="noopener noreffer">https://v1-29.docs.kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/</a>
</p>
</blockquote>
<h3 id="1-upgrade-kubeadm-master-node">1. Upgrade kubeadm master node</h3>
<ol start="0">
<li>
<p>k drain <node> &ndash;ignore-daemonsets</p>
</li>
<li>
<p>(opt) <a href="https://v1-29.docs.kubernetes.io/docs/tasks/administer-cluster/kubeadm/change-package-repository/" target="_blank" rel="noopener noreffer">Update package repository</a>
</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">pager</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">list</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">deb</span> <span class="p">[</span><span class="n">signed</span><span class="o">-</span><span class="n">by</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">keyrings</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">keyri</span>
</span></span><span class="line"><span class="cl"><span class="n">ng</span><span class="o">.</span><span class="n">gpg</span><span class="p">]</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pkgs</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">core</span><span class="p">:</span><span class="o">/</span><span class="n">stable</span><span class="p">:</span><span class="o">/</span><span class="n">v1</span><span class="mf">.28</span><span class="o">/</span><span class="n">deb</span><span class="o">/</span> 
</span></span><span class="line"><span class="cl"><span class="o">/</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Switching to another Kubernetes package repository</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">list</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># change version v1.28 -&gt; v1.29</span>
</span></span><span class="line"><span class="cl"><span class="p">:</span><span class="n">s</span><span class="o">/</span><span class="n">v1</span><span class="mf">.28</span><span class="o">/</span><span class="n">v1</span><span class="mf">.29</span><span class="o">/</span><span class="n">g</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>Determine which version to upgrade to</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">cache</span> <span class="n">madison</span> <span class="n">kubeadm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="n">kubeadm</span> <span class="o">|</span> <span class="mf">1.29.4</span><span class="o">-</span><span class="mf">2.1</span> <span class="o">|</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pkgs</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">core</span><span class="p">:</span><span class="o">/</span><span class="n">stable</span><span class="p">:</span><span class="o">/</span><span class="n">v1</span><span class="mf">.29</span><span class="o">/</span><span class="n">deb</span>  <span class="n">Packages</span>
</span></span><span class="line"><span class="cl">   <span class="n">kubeadm</span> <span class="o">|</span> <span class="mf">1.29.3</span><span class="o">-</span><span class="mf">1.1</span> <span class="o">|</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pkgs</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">core</span><span class="p">:</span><span class="o">/</span><span class="n">stable</span><span class="p">:</span><span class="o">/</span><span class="n">v1</span><span class="mf">.29</span><span class="o">/</span><span class="n">deb</span>  <span class="n">Packages</span>
</span></span><span class="line"><span class="cl">   <span class="n">kubeadm</span> <span class="o">|</span> <span class="mf">1.29.2</span><span class="o">-</span><span class="mf">1.1</span> <span class="o">|</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pkgs</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">core</span><span class="p">:</span><span class="o">/</span><span class="n">stable</span><span class="p">:</span><span class="o">/</span><span class="n">v1</span><span class="mf">.29</span><span class="o">/</span><span class="n">deb</span>  <span class="n">Packages</span>
</span></span><span class="line"><span class="cl">   <span class="n">kubeadm</span> <span class="o">|</span> <span class="mf">1.29.1</span><span class="o">-</span><span class="mf">1.1</span> <span class="o">|</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pkgs</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">core</span><span class="p">:</span><span class="o">/</span><span class="n">stable</span><span class="p">:</span><span class="o">/</span><span class="n">v1</span><span class="mf">.29</span><span class="o">/</span><span class="n">deb</span>  <span class="n">Packages</span>
</span></span><span class="line"><span class="cl">   <span class="n">kubeadm</span> <span class="o">|</span> <span class="mf">1.29.0</span><span class="o">-</span><span class="mf">1.1</span> <span class="o">|</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pkgs</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">core</span><span class="p">:</span><span class="o">/</span><span class="n">stable</span><span class="p">:</span><span class="o">/</span><span class="n">v1</span><span class="mf">.29</span><span class="o">/</span><span class="n">deb</span>  <span class="n">Packages</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>Upgrading control plane nodes</li>
</ol>
<ul>
<li>upgrade kubeadm</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">mark</span> <span class="n">unhold</span> <span class="n">kubeadm</span> <span class="o">&amp;&amp;</span> \
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">kubeadm</span><span class="o">=</span><span class="mf">1.29.0</span><span class="o">-</span><span class="mf">1.1</span> <span class="o">&amp;&amp;</span> \
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">mark</span> <span class="n">hold</span> <span class="n">kubeadm</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>verify the upgrade plan</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">target_version</span><span class="o">=</span><span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">kubeadm</span> <span class="n">upgrade</span> <span class="n">plan</span> <span class="err">$</span><span class="n">target_version</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">upgrade</span><span class="o">/</span><span class="n">config</span><span class="p">]</span> <span class="n">Making</span> <span class="n">sure</span> <span class="n">the</span> <span class="n">configuration</span> <span class="ow">is</span> <span class="n">correct</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">upgrade</span><span class="o">/</span><span class="n">config</span><span class="p">]</span> <span class="n">Reading</span> <span class="n">configuration</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">cluster</span><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">upgrade</span><span class="o">/</span><span class="n">config</span><span class="p">]</span> <span class="n">FYI</span><span class="p">:</span> <span class="n">You</span> <span class="n">can</span> <span class="n">look</span> <span class="n">at</span> <span class="n">this</span> <span class="n">config</span> <span class="n">file</span> <span class="k">with</span> <span class="s1">&#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">preflight</span><span class="p">]</span> <span class="n">Running</span> <span class="n">pre</span><span class="o">-</span><span class="n">flight</span> <span class="n">checks</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">upgrade</span><span class="p">]</span> <span class="n">Running</span> <span class="n">cluster</span> <span class="n">health</span> <span class="n">checks</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">upgrade</span><span class="p">]</span> <span class="n">Fetching</span> <span class="n">available</span> <span class="n">versions</span> <span class="n">to</span> <span class="n">upgrade</span> <span class="n">to</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">upgrade</span><span class="o">/</span><span class="n">versions</span><span class="p">]</span> <span class="n">Cluster</span> <span class="n">version</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.28.0</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">upgrade</span><span class="o">/</span><span class="n">versions</span><span class="p">]</span> <span class="n">kubeadm</span> <span class="n">version</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">upgrade</span><span class="o">/</span><span class="n">versions</span><span class="p">]</span> <span class="n">Target</span> <span class="n">version</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">upgrade</span><span class="o">/</span><span class="n">versions</span><span class="p">]</span> <span class="n">Latest</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">v1</span><span class="mf">.28</span> <span class="n">series</span><span class="p">:</span> <span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Components</span> <span class="n">that</span> <span class="n">must</span> <span class="n">be</span> <span class="n">upgraded</span> <span class="n">manually</span> <span class="n">after</span> <span class="n">you</span> <span class="n">have</span> <span class="n">upgraded</span> <span class="n">the</span> <span class="n">control</span> <span class="n">plane</span> <span class="k">with</span> <span class="s1">&#39;kubeadm upgrade apply&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">COMPONENT</span>   <span class="n">CURRENT</span>       <span class="n">TARGET</span>
</span></span><span class="line"><span class="cl"><span class="n">kubelet</span>     <span class="mi">2</span> <span class="n">x</span> <span class="n">v1</span><span class="mf">.28.0</span>   <span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Upgrade</span> <span class="n">to</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">v1</span><span class="mf">.28</span> <span class="n">series</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">COMPONENT</span>                 <span class="n">CURRENT</span>   <span class="n">TARGET</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">apiserver</span>            <span class="n">v1</span><span class="mf">.28.0</span>   <span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">manager</span>   <span class="n">v1</span><span class="mf">.28.0</span>   <span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">scheduler</span>            <span class="n">v1</span><span class="mf">.28.0</span>   <span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl"><span class="n">kube</span><span class="o">-</span><span class="n">proxy</span>                <span class="n">v1</span><span class="mf">.28.0</span>   <span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl"><span class="n">CoreDNS</span>                   <span class="n">v1</span><span class="mf">.10.1</span>   <span class="n">v1</span><span class="mf">.11.1</span>
</span></span><span class="line"><span class="cl"><span class="n">etcd</span>                      <span class="mf">3.5.9</span><span class="o">-</span><span class="mi">0</span>   <span class="mf">3.5.10</span><span class="o">-</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">You</span> <span class="n">can</span> <span class="n">now</span> <span class="n">apply</span> <span class="n">the</span> <span class="n">upgrade</span> <span class="n">by</span> <span class="n">executing</span> <span class="n">the</span> <span class="n">following</span> <span class="n">command</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">kubeadm</span> <span class="n">upgrade</span> <span class="n">apply</span> <span class="n">v1</span><span class="mf">.29.0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">_____________________________________________________________________</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">The</span> <span class="n">table</span> <span class="n">below</span> <span class="n">shows</span> <span class="n">the</span> <span class="n">current</span> <span class="n">state</span> <span class="n">of</span> <span class="n">component</span> <span class="n">configs</span> <span class="k">as</span> <span class="n">understood</span> <span class="n">by</span> <span class="n">this</span> <span class="n">version</span> <span class="n">of</span> <span class="n">kubeadm</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Configs</span> <span class="n">that</span> <span class="n">have</span> <span class="n">a</span> <span class="s2">&#34;yes&#34;</span> <span class="n">mark</span> <span class="ow">in</span> <span class="n">the</span> <span class="s2">&#34;MANUAL UPGRADE REQUIRED&#34;</span> <span class="n">column</span> <span class="n">require</span> <span class="n">manual</span> <span class="n">config</span> <span class="n">upgrade</span> <span class="ow">or</span>
</span></span><span class="line"><span class="cl"><span class="n">resetting</span> <span class="n">to</span> <span class="n">kubeadm</span> <span class="n">defaults</span> <span class="n">before</span> <span class="n">a</span> <span class="n">successful</span> <span class="n">upgrade</span> <span class="n">can</span> <span class="n">be</span> <span class="n">performed</span><span class="o">.</span> <span class="n">The</span> <span class="n">version</span> <span class="n">to</span> <span class="n">manually</span>
</span></span><span class="line"><span class="cl"><span class="n">upgrade</span> <span class="n">to</span> <span class="ow">is</span> <span class="n">denoted</span> <span class="ow">in</span> <span class="n">the</span> <span class="s2">&#34;PREFERRED VERSION&#34;</span> <span class="n">column</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">API</span> <span class="n">GROUP</span>                 <span class="n">CURRENT</span> <span class="n">VERSION</span>   <span class="n">PREFERRED</span> <span class="n">VERSION</span>   <span class="n">MANUAL</span> <span class="n">UPGRADE</span> <span class="n">REQUIRED</span>
</span></span><span class="line"><span class="cl"><span class="n">kubeproxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span>   <span class="n">v1alpha1</span>          <span class="n">v1alpha1</span>            <span class="n">no</span>
</span></span><span class="line"><span class="cl"><span class="n">kubelet</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span>     <span class="n">v1beta1</span>           <span class="n">v1beta1</span>             <span class="n">no</span>
</span></span><span class="line"><span class="cl"><span class="n">_____________________________________________________________________</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>choose a version to upgrade and apply</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">kubeadm</span> <span class="n">upgrade</span> <span class="n">apply</span> <span class="err">$</span><span class="n">target_version</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, upgrade the version and restart Kubelet. Also, mark the node (in this case, the &ldquo;controlplane&rdquo; node) as schedulable.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">mark</span> <span class="n">unhold</span> <span class="n">kubelet</span> <span class="n">kubectl</span> <span class="o">&amp;&amp;</span> \
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">kubelet</span><span class="o">=</span><span class="s1">&#39;1.29.0-1.1&#39;</span> <span class="n">kubectl</span><span class="o">=</span><span class="s1">&#39;1.29.0-1.1&#39;</span> <span class="o">&amp;&amp;</span> \
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">mark</span> <span class="n">hold</span> <span class="n">kubelet</span> <span class="n">kubectl</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">daemon</span><span class="o">-</span><span class="n">reload</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">kubelet</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">kubectl</span> <span class="n">uncordon</span> <span class="n">controlplane</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="2-upgrade-kubeadm-worker-node">2. Upgrade kubeadm worker node</h3>
<ol>
<li>
<p>mirror update</p>
</li>
<li>
<p><a href="https://v1-29.docs.kubernetes.io/docs/tasks/administer-cluster/kubeadm/upgrading-linux-nodes/" target="_blank" rel="noopener noreffer">https://v1-29.docs.kubernetes.io/docs/tasks/administer-cluster/kubeadm/upgrading-linux-nodes/</a>
</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">mark</span> <span class="n">unhold</span> <span class="n">kubeadm</span> <span class="o">&amp;&amp;</span> \
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">kubeadm</span><span class="o">=</span><span class="s1">&#39;1.29.0-1.1&#39;</span> <span class="o">&amp;&amp;</span> \
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">mark</span> <span class="n">hold</span> <span class="n">kubeadm</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>kubeadm upgrade node (instead apply)</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">kubeadm</span> <span class="n">upgrade</span> <span class="n">node</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>updgrade kubelet and kubectl</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">mark</span> <span class="n">unhold</span> <span class="n">kubelet</span> <span class="n">kubectl</span> <span class="o">&amp;&amp;</span> \
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">kubelet</span><span class="o">=</span><span class="s1">&#39;1.29.0-1.1&#39;</span> <span class="n">kubectl</span><span class="o">=</span><span class="s1">&#39;1.29.0-1.1&#39;</span> <span class="o">&amp;&amp;</span> \
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">mark</span> <span class="n">hold</span> <span class="n">kubelet</span> <span class="n">kubectl</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">daemon</span><span class="o">-</span><span class="n">reload</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">kubelet</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">exit</span> <span class="p">(</span><span class="n">back</span> <span class="n">to</span> <span class="n">master</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">kubectl</span> <span class="n">uncordon</span> <span class="n">node01</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-problem-backup-and-restore-etcd">3. Problem: backup and restore etcd</h3>
<blockquote>
<p>Q. An ETCD backup for cluster2 is stored at /opt/cluster2.db. Use this snapshot file to carryout a restore on cluster2 to a new path /var/lib/etcd-data-new. Once the restore is complete, ensure that the controlplane components on cluster2 are running. The snapshot was taken when there were objects created in the critical namespace on cluster2. These objects should be available post restore.</p>
</blockquote>
<h3 id="solution">Solution</h3>
<p>Step 1. Copy the snapshot file from the student-node to the etcd-server. In the example below, we are copying it to the /root directory:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">student</span><span class="o">-</span><span class="n">node</span> <span class="o">~</span>  <span class="n">scp</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">cluster2</span><span class="o">.</span><span class="n">db</span> <span class="n">etcd</span><span class="o">-</span><span class="n">server</span><span class="p">:</span><span class="o">/</span><span class="n">root</span>
</span></span><span class="line"><span class="cl"><span class="n">cluster2</span><span class="o">.</span><span class="n">db</span>                                                                                                        <span class="mi">100</span><span class="o">%</span> <span class="mi">1108</span><span class="n">KB</span> <span class="mf">178.5</span><span class="n">MB</span><span class="o">/</span><span class="n">s</span>   <span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">student</span><span class="o">-</span><span class="n">node</span> <span class="o">~</span> <span class="err">➜</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>Step 2: Restore the snapshot on the cluster2. Since we are restoring directly on the etcd-server, we can use the endpoint https:/127.0.0.1. Use the same certificates that were identified earlier. Make sure to use the data-dir as /var/lib/etcd-data-new:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">etcd</span><span class="o">-</span><span class="n">server</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">ETCDCTL_API</span><span class="o">=</span><span class="mi">3</span> <span class="n">etcdctl</span> <span class="o">--</span><span class="n">endpoints</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">2379</span> <span class="o">--</span><span class="n">cacert</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">etcd</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">ca</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">cert</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">etcd</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">etcd</span><span class="o">.</span><span class="n">pem</span> <span class="o">--</span><span class="n">key</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">etcd</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">etcd</span><span class="o">-</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span> <span class="n">snapshot</span> <span class="n">restore</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">cluster2</span><span class="o">.</span><span class="n">db</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="nb">dir</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">etcd</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">new</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s2">&#34;level&#34;</span><span class="p">:</span><span class="s2">&#34;info&#34;</span><span class="p">,</span><span class="s2">&#34;ts&#34;</span><span class="p">:</span><span class="mf">1662004927.2399247</span><span class="p">,</span><span class="s2">&#34;caller&#34;</span><span class="p">:</span><span class="s2">&#34;snapshot/v3_snapshot.go:296&#34;</span><span class="p">,</span><span class="s2">&#34;msg&#34;</span><span class="p">:</span><span class="s2">&#34;restoring snapshot&#34;</span><span class="p">,</span><span class="s2">&#34;path&#34;</span><span class="p">:</span><span class="s2">&#34;/root/cluster2.db&#34;</span><span class="p">,</span><span class="s2">&#34;wal-dir&#34;</span><span class="p">:</span><span class="s2">&#34;/var/lib/etcd-data-new/member/wal&#34;</span><span class="p">,</span><span class="s2">&#34;data-dir&#34;</span><span class="p">:</span><span class="s2">&#34;/var/lib/etcd-data-new&#34;</span><span class="p">,</span><span class="s2">&#34;snap-dir&#34;</span><span class="p">:</span><span class="s2">&#34;/var/lib/etcd-data-new/member/snap&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s2">&#34;level&#34;</span><span class="p">:</span><span class="s2">&#34;info&#34;</span><span class="p">,</span><span class="s2">&#34;ts&#34;</span><span class="p">:</span><span class="mf">1662004927.2584803</span><span class="p">,</span><span class="s2">&#34;caller&#34;</span><span class="p">:</span><span class="s2">&#34;membership/cluster.go:392&#34;</span><span class="p">,</span><span class="s2">&#34;msg&#34;</span><span class="p">:</span><span class="s2">&#34;added member&#34;</span><span class="p">,</span><span class="s2">&#34;cluster-id&#34;</span><span class="p">:</span><span class="s2">&#34;cdf818194e3a8c32&#34;</span><span class="p">,</span><span class="s2">&#34;local-member-id&#34;</span><span class="p">:</span><span class="s2">&#34;0&#34;</span><span class="p">,</span><span class="s2">&#34;added-peer-id&#34;</span><span class="p">:</span><span class="s2">&#34;8e9e05c52164694d&#34;</span><span class="p">,</span><span class="s2">&#34;added-peer-peer-urls&#34;</span><span class="p">:[</span><span class="s2">&#34;http://localhost:2380&#34;</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s2">&#34;level&#34;</span><span class="p">:</span><span class="s2">&#34;info&#34;</span><span class="p">,</span><span class="s2">&#34;ts&#34;</span><span class="p">:</span><span class="mf">1662004927.264258</span><span class="p">,</span><span class="s2">&#34;caller&#34;</span><span class="p">:</span><span class="s2">&#34;snapshot/v3_snapshot.go:309&#34;</span><span class="p">,</span><span class="s2">&#34;msg&#34;</span><span class="p">:</span><span class="s2">&#34;restored snapshot&#34;</span><span class="p">,</span><span class="s2">&#34;path&#34;</span><span class="p">:</span><span class="s2">&#34;/root/cluster2.db&#34;</span><span class="p">,</span><span class="s2">&#34;wal-dir&#34;</span><span class="p">:</span><span class="s2">&#34;/var/lib/etcd-data-new/member/wal&#34;</span><span class="p">,</span><span class="s2">&#34;data-dir&#34;</span><span class="p">:</span><span class="s2">&#34;/var/lib/etcd-data-new&#34;</span><span class="p">,</span><span class="s2">&#34;snap-dir&#34;</span><span class="p">:</span><span class="s2">&#34;/var/lib/etcd-data-new/member/snap&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">etcd</span><span class="o">-</span><span class="n">server</span> <span class="o">~</span> <span class="err">➜</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>Step 3: Update the systemd service unit file for etcdby running vi /etc/systemd/system/etcd.service and add the new value for data-dir:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">Description</span><span class="o">=</span><span class="n">etcd</span> <span class="n">key</span><span class="o">-</span><span class="n">value</span> <span class="n">store</span>
</span></span><span class="line"><span class="cl"><span class="n">Documentation</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">etcd</span><span class="o">-</span><span class="n">io</span><span class="o">/</span><span class="n">etcd</span>
</span></span><span class="line"><span class="cl"><span class="n">After</span><span class="o">=</span><span class="n">network</span><span class="o">.</span><span class="n">target</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">Service</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">User</span><span class="o">=</span><span class="n">etcd</span>
</span></span><span class="line"><span class="cl"><span class="n">Type</span><span class="o">=</span><span class="n">notify</span>
</span></span><span class="line"><span class="cl"><span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">etcd</span> \
</span></span><span class="line"><span class="cl">  <span class="o">--</span><span class="n">name</span> <span class="n">etcd</span><span class="o">-</span><span class="n">server</span> \
</span></span><span class="line"><span class="cl">  <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">dir</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">etcd</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">new</span> \
</span></span><span class="line"><span class="cl"><span class="o">---</span><span class="n">End</span> <span class="n">of</span> <span class="n">Snippet</span><span class="o">---</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Step 4: make sure the permissions on the new directory is correct (should be owned by etcd user):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">etcd</span><span class="o">-</span><span class="n">server</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span> <span class="err">➜</span>  <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">etcd</span><span class="p">:</span><span class="n">etcd</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">etcd</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">new</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">etcd</span><span class="o">-</span><span class="n">server</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span> <span class="err">➜</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">etcd</span><span class="o">-</span><span class="n">server</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span> <span class="err">➜</span>  <span class="n">ls</span> <span class="o">-</span><span class="n">ld</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">etcd</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">new</span><span class="o">/</span>
</span></span><span class="line"><span class="cl"><span class="n">drwx</span><span class="o">------</span> <span class="mi">3</span> <span class="n">etcd</span> <span class="n">etcd</span> <span class="mi">4096</span> <span class="n">Sep</span>  <span class="mi">1</span> <span class="mi">02</span><span class="p">:</span><span class="mi">41</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">etcd</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">new</span><span class="o">/</span>
</span></span><span class="line"><span class="cl"><span class="n">etcd</span><span class="o">-</span><span class="n">server</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span> <span class="err">➜</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Step 5: Finally, reload and restart the etcd service.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">etcd</span><span class="o">-</span><span class="n">server</span> <span class="o">~/</span><span class="n">default</span><span class="o">.</span><span class="n">etcd</span> <span class="err">➜</span>  <span class="n">systemctl</span> <span class="n">daemon</span><span class="o">-</span><span class="n">reload</span> 
</span></span><span class="line"><span class="cl"><span class="n">etcd</span><span class="o">-</span><span class="n">server</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">etcd</span>
</span></span><span class="line"><span class="cl"><span class="n">etcd</span><span class="o">-</span><span class="n">server</span> <span class="o">~</span> <span class="err">➜</span>  
</span></span></code></pre></td></tr></table>
</div>
</div><p>Step 6 (optional): It is recommended to restart controlplane components (e.g. kube-scheduler, kube-controller-manager, kubelet) to ensure that they don&rsquo;t rely on some stale data.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">student</span><span class="o">-</span><span class="n">node</span> <span class="o">~</span> <span class="err">✖</span> <span class="n">k</span> <span class="n">delete</span> <span class="n">po</span> <span class="n">kube</span><span class="o">-</span><span class="n">apiserver</span><span class="o">-</span><span class="n">cluster2</span><span class="o">-</span><span class="n">controlplane</span> <span class="n">kube</span><span class="o">-</span><span class="n">controller</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">cluster2</span><span class="o">-</span><span class="n">controlplane</span> <span class="n">kube</span><span class="o">-</span><span class="n">scheduler</span><span class="o">-</span><span class="n">cluster2</span><span class="o">-</span><span class="n">controlplane</span> <span class="o">-</span><span class="n">n</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span> 
</span></span><span class="line"><span class="cl"><span class="n">pod</span> <span class="s2">&#34;kube-apiserver-cluster2-controlplane&#34;</span> <span class="n">deleted</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span> <span class="s2">&#34;kube-controller-manager-cluster2-controlplane&#34;</span> <span class="n">deleted</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span> <span class="s2">&#34;kube-scheduler-cluster2-controlplane&#34;</span> <span class="n">deleted</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ssh</span> <span class="n">cluster2</span><span class="o">-</span><span class="n">controlplane</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cluster2</span><span class="o">-</span><span class="n">controlplane</span> <span class="o">~</span> <span class="err">✖</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">kubelet</span>
</span></span><span class="line"><span class="cl"><span class="n">cluster2</span><span class="o">-</span><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">systemctl</span> <span class="n">status</span> <span class="n">kubelet</span>
</span></span><span class="line"><span class="cl"><span class="err">●</span> <span class="n">kubelet</span><span class="o">.</span><span class="n">service</span> <span class="o">-</span> <span class="n">kubelet</span><span class="p">:</span> <span class="n">The</span> <span class="n">Kubernetes</span> <span class="n">Node</span> <span class="n">Agent</span>
</span></span><span class="line"><span class="cl">   <span class="n">Loaded</span><span class="p">:</span> <span class="n">loaded</span> <span class="p">(</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">kubelet</span><span class="o">.</span><span class="n">service</span><span class="p">;</span> <span class="n">enabled</span><span class="p">;</span> <span class="n">vendor</span> <span class="n">preset</span><span class="p">:</span> <span class="n">enabled</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">Drop</span><span class="o">-</span><span class="n">In</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">kubelet</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">d</span>
</span></span><span class="line"><span class="cl">           <span class="err">└─</span><span class="mi">10</span><span class="o">-</span><span class="n">kubeadm</span><span class="o">.</span><span class="n">conf</span>
</span></span><span class="line"><span class="cl">   <span class="n">Active</span><span class="p">:</span> <span class="n">active</span> <span class="p">(</span><span class="n">running</span><span class="p">)</span> <span class="n">since</span> <span class="n">Sat</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">27</span> <span class="mi">13</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">11</span> <span class="n">UTC</span><span class="p">;</span> <span class="mi">6</span><span class="n">s</span> <span class="n">ago</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="chapter-7-security">Chapter 7: Security</h1>
<blockquote>
<p><a href="https://kubernetes.io/docs/concepts/security/" target="_blank" rel="noopener noreffer">https://kubernetes.io/docs/concepts/security/</a>
</p>
</blockquote>
<h2 id="authentication">Authentication</h2>
<ul>
<li>Account</li>
<li>Service accuount</li>
</ul>
<p>All the user authentication is managed by kube-apiserver, authenticate</p>
<h2 id="tls-certificates">TLS Certificates</h2>
<ul>
<li>key, pem = public, priviate</li>
<li>certificate</li>
<li>certificate authority (CA)</li>
<li>Certificate Signning Request (CSR): with public key</li>
<li>PKI (public Key infrastructure)</li>
</ul>
<h3 id="format">Format</h3>
<ul>
<li>Certificate (pulic key)
<ul>
<li>**<em>.crt, <em>.pem</em></em></li>
<li>i.g. server.crt, server.pem, client.crt, client.pem</li>
</ul>
</li>
<li>Private key
<ul>
<li>**<em>.key, <em>-key.pem</em></em></li>
<li>i.g. server.key, server-key.pem, client.key, client-key.pem</li>
</ul>
</li>
</ul>
<p>When server requests to CSR to certify server with CSR, CA will verify the request and if it passed, then CA encrypt request(+server&rsquo;s pub key) with CA&rsquo;s private key and return to server and finally return to client.</p>
<p>Client especially browser has CA&rsquo;s public key so that the browsers uses the public key of the Certificate Authority to validate the certificate was actually signed by the Verified Certificate Authority themselves.</p>
<blockquote>
<p>Q. But does the public key is only for encryption not decryption then how does browser validate ca&rsquo;s encrypted data is valid or not?</p>
</blockquote>
<p>In public key cryptography, the public key is indeed primarily used for encryption, <strong>but it also has a crucial role in verifying digital signatures</strong>. Digital signatures are created by encrypting a hash (a unique fingerprint) of the data using the private key. The resulting encrypted hash, along with the data, forms the digital signature.</p>
<p>To verify the digital signature, the recipient uses the public key associated with the private key used to create the signature. This process works as follows:</p>
<ol>
<li>The recipient uses the public key to decrypt the digital signature, resulting in the original hash value.</li>
<li>The recipient independently computes the hash of the received data.</li>
<li>If the decrypted hash matches the independently computed hash, the signature is valid. This indicates that the data hasn&rsquo;t been altered since it was signed and that the signature was indeed created with the private key associated with the public key used for decryption.</li>
</ol>
<p>In the context of SSL/TLS certificates:</p>
<ul>
<li>The Certificate Authority (CA) signs the digital certificate with its private key, creating a digital signature.</li>
<li>Your browser, possessing the CA&rsquo;s public key, decrypts the digital signature to obtain the hash of the certificate.</li>
<li>The browser then independently computes the hash of the certificate data.</li>
<li>If the decrypted hash matches the computed hash, the browser knows that the certificate is authentic and was indeed issued by the CA. (decrypt라는 용어가 광범위하게 잘못사용되는 것도 한 몫하는 것 같다.)</li>
</ul>
<p>So, the CA&rsquo;s public key is used to validate the CA&rsquo;s digital signature on the certificate by decrypting the signature and verifying its integrity, ensuring that it was signed with the CA&rsquo;s private key.</p>
<blockquote>
<p>Q. Then how computed hash can ensures whether the signature is valid or not?</p>
</blockquote>
<p>public key cryptography: A class of cryptographic techniques employing two-key ciphers. <strong>Messages encrypted with the public key can only be decrypted with the associated private key. Conversely, messages signed with the private key can be verified with the public key.</strong></p>
<ol>
<li>CA public key로 valid 하다고 판결하면, server를 신뢰하고, 서버의 public key를 신뢰해서, 이를 통해서 symm key를 encrypt해서 server에 보낸다. 중간에 이를 가로채는 것은 서버가 정상 서비스 업체라고 가정한다면, private key를 마음대로 사용하지 않을테니 중간에 가로챈 사람들을 symm key를 복호화 할 수 없다.</li>
</ol>
<h2 id="tls-in-kubernetes">TLS in kubernetes</h2>
<ul>
<li>Root Certificates (CA)</li>
<li>Server Certificates (server)</li>
<li>Client Certificates (client)</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-tls.png"
        data-srcset="/images/k8s-tls.png, /images/k8s-tls.png 1.5x, /images/k8s-tls.png 2x"
        data-sizes="auto"
        alt="/images/k8s-tls.png"
        title="/images/k8s-tls.png" /></p>
<h3 id="server-certificates-for-servers">Server Certificates for servers</h3>
<ul>
<li>KUBE-API server
<ul>
<li>apiserver.crt</li>
<li>apiserver.key</li>
</ul>
</li>
<li>ETCD server
<ul>
<li>etcdserver.crt</li>
<li>etcdserver.key</li>
</ul>
</li>
<li>KUBELET server (node01, node02 &hellip;.)
<ul>
<li>node01.crt</li>
<li>node01.key</li>
</ul>
</li>
</ul>
<h3 id="client-certificates-for-clients">Client Certificates for clients</h3>
<ul>
<li>admin user: kubectl REST API to access kube-api server
<ul>
<li>admin.crt</li>
<li>admin.key</li>
</ul>
</li>
<li>KUBE SCHEDULER: to access kube-api server API
<ul>
<li>scheduler.crt</li>
<li>scheduler.key</li>
</ul>
</li>
<li>KUBE CONTROLLER-MANAGER: to access kube-api server api
<ul>
<li>controller-manager.crt</li>
<li>controller-manager.key</li>
</ul>
</li>
<li>KUBE-PROXY
<ul>
<li>kube-proxy.crt</li>
<li>kube-proxy.key</li>
</ul>
</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-tls2.png"
        data-srcset="/images/k8s-tls2.png, /images/k8s-tls2.png 1.5x, /images/k8s-tls2.png 2x"
        data-sizes="auto"
        alt="/images/k8s-tls2.png"
        title="/images/k8s-tls2.png" /></p>
<h2 id="kube-config">Kube config</h2>
<p>Kubeconfig is the file to organize information about clusters, users, namespaces and authentication mechanisms.</p>
<p>kubectl command line tool uses kubeconfig file to find the information it needs to choose a cluster and communicate with API server of a cluster. Which  measn kubeconfig contains</p>
<ul>
<li>kind: Config</li>
<li>cluster</li>
<li>contexts: mapping with cluster and users
<ul>
<li>namespace</li>
</ul>
</li>
<li>users
<ul>
<li>crt files</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">k</span> <span class="n">config</span> <span class="n">view</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">k</span> <span class="n">config</span> <span class="n">use</span><span class="o">-</span><span class="n">context</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Base directory is <code>$HOME/.kube/config</code>.</p>
<p><code>echo env | grep -i HOME</code> to figure out home</p>
<h2 id="authorization">Authorization</h2>
<ol>
<li>ABAC: user당 json형식으로 kind: policy를 관리하는 방식</li>
<li>RBAC: policy group을 rule로 묶고, user와 binding하는 방식</li>
<li>Webhook</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># kubeadm </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">manifests</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">apiserver</span><span class="o">.</span><span class="n">yaml</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">authorizaion</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="n">elipsis</span>
</span></span><span class="line"><span class="cl"><span class="o">--</span><span class="n">authorization</span><span class="o">-</span><span class="n">mode</span><span class="o">=</span><span class="n">Node</span><span class="p">,</span><span class="n">RBAC</span><span class="p">,</span><span class="n">Webhook</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Above setting means first Node auth try and RBAC try and Webhook try</p>
<h2 id="rbac">RBAC</h2>
<ul>
<li>Role and Role Bindings are under the scope of namespaces
<ul>
<li>so withoud namespace = default namespace role</li>
<li>with namespace -&gt; specific namespace</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># check Access</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">auth</span> <span class="n">can</span><span class="o">-</span><span class="n">i</span> <span class="n">create</span> <span class="n">deployments</span> <span class="o">--</span><span class="k">as</span> <span class="n">dev</span><span class="o">-</span><span class="n">user</span> <span class="o">-</span><span class="n">n</span> <span class="n">production</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">auth</span> <span class="n">can</span><span class="o">-</span><span class="n">i</span> <span class="nb">list</span> <span class="n">nodes</span> <span class="o">--</span><span class="k">as</span> <span class="n">michelle</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cluster-roles">Cluster Roles</h2>
<p>Unlike Role, Cluster-Role&rsquo;s scope is not limited by namespace. In other words, it applies to all namespaces.</p>
<ul>
<li>Namespaced
<ul>
<li>pods, replicasets, jobs, deployments, services, secrets, roles, rolebindings configmaps, pvc</li>
<li><code>k api-resources --namespaced=true</code></li>
</ul>
</li>
<li>Cluster Scoped
<ul>
<li>nodes, PV, clusterrole, clusterrolebindings, certificatesigningrequests(csr), namespaces</li>
<li><code>k api-resources --namespaced=false</code></li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">create</span> <span class="n">clusterrole</span> <span class="n">storage</span><span class="o">-</span><span class="n">admin</span> <span class="o">--</span><span class="n">resource</span><span class="o">=</span><span class="n">persistentvolumes</span><span class="p">,</span><span class="n">storageclasses</span> <span class="o">--</span><span class="n">verb</span><span class="o">=*</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">k</span> <span class="n">get</span> <span class="n">clusterrole</span> <span class="n">storage</span><span class="o">-</span><span class="n">admin</span> <span class="o">-</span><span class="n">o</span> <span class="n">yaml</span>
</span></span><span class="line"><span class="cl"><span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
</span></span><span class="line"><span class="cl"><span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
</span></span><span class="line"><span class="cl"><span class="n">metadata</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">creationTimestamp</span><span class="p">:</span> <span class="s2">&#34;2024-05-04T06:22:03Z&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span><span class="p">:</span> <span class="n">storage</span><span class="o">-</span><span class="n">admin</span>
</span></span><span class="line"><span class="cl">  <span class="n">resourceVersion</span><span class="p">:</span> <span class="s2">&#34;1696&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">uid</span><span class="p">:</span> <span class="n">d73ce51f</span><span class="o">-</span><span class="mi">6</span><span class="n">ea7</span><span class="o">-</span><span class="mi">4</span><span class="n">dfa</span><span class="o">-</span><span class="mi">9</span><span class="n">db9</span><span class="o">-</span><span class="mf">2564e3</span><span class="n">fa277c</span>
</span></span><span class="line"><span class="cl"><span class="n">rules</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">resources</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="n">persistentvolumes</span>
</span></span><span class="line"><span class="cl">  <span class="n">verbs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="s1">&#39;*&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="n">storage</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span>
</span></span><span class="line"><span class="cl">  <span class="n">resources</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="n">storageclasses</span>
</span></span><span class="line"><span class="cl">  <span class="n">verbs</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span> <span class="s1">&#39;*&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="service-account">Service account</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-ua-vs-sa.png"
        data-srcset="/images/k8s-ua-vs-sa.png, /images/k8s-ua-vs-sa.png 1.5x, /images/k8s-ua-vs-sa.png 2x"
        data-sizes="auto"
        alt="/images/k8s-ua-vs-sa.png"
        title="/images/k8s-ua-vs-sa.png" /></p>
<p>The user account is literally an account for users, and the service account is literally an account for services such as Prometheus, Grafana, Kubeflow..</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">get</span> <span class="n">sa</span> <span class="o">-</span><span class="n">n</span> <span class="n">default</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>      <span class="n">SECRETS</span>   <span class="n">AGE</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>   <span class="mi">0</span>         <span class="mi">11</span><span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="n">dev</span>       <span class="mi">0</span>         <span class="mi">52</span><span class="n">s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">create</span> <span class="n">sa</span> <span class="n">test</span><span class="o">-</span><span class="n">sa</span>
</span></span><span class="line"><span class="cl"><span class="n">serviceaccount</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">sa</span> <span class="n">created</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">get</span> <span class="n">sa</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>      <span class="n">SECRETS</span>   <span class="n">AGE</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>   <span class="mi">0</span>         <span class="mi">11</span><span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="n">dev</span>       <span class="mi">0</span>         <span class="mi">85</span><span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">test</span><span class="o">-</span><span class="n">sa</span>   <span class="mi">0</span>         <span class="mi">3</span><span class="n">s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">describe</span> <span class="n">sa</span> <span class="n">test</span><span class="o">-</span><span class="n">sa</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span>                <span class="n">test</span><span class="o">-</span><span class="n">sa</span>
</span></span><span class="line"><span class="cl"><span class="n">Namespace</span><span class="p">:</span>           <span class="n">default</span>
</span></span><span class="line"><span class="cl"><span class="n">Labels</span><span class="p">:</span>              <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Annotations</span><span class="p">:</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Image</span> <span class="n">pull</span> <span class="n">secrets</span><span class="p">:</span>  <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Mountable</span> <span class="n">secrets</span><span class="p">:</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Tokens</span><span class="p">:</span>              <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Events</span><span class="p">:</span>              <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Every namespace has it&rsquo;s own default service account</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">describe</span> <span class="n">sa</span> <span class="n">default</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span>                <span class="n">default</span>
</span></span><span class="line"><span class="cl"><span class="n">Namespace</span><span class="p">:</span>           <span class="n">default</span>
</span></span><span class="line"><span class="cl"><span class="n">Labels</span><span class="p">:</span>              <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Annotations</span><span class="p">:</span>         <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Image</span> <span class="n">pull</span> <span class="n">secrets</span><span class="p">:</span>  <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Mountable</span> <span class="n">secrets</span><span class="p">:</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Tokens</span><span class="p">:</span>              <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Events</span><span class="p">:</span>              <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">get</span> <span class="n">po</span>
</span></span><span class="line"><span class="cl"><span class="n">No</span> <span class="n">resources</span> <span class="n">found</span> <span class="ow">in</span> <span class="n">default</span> <span class="n">namespace</span><span class="o">.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>default sa is used when, create resources without sa</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">run</span> <span class="n">nginx</span> <span class="o">--</span><span class="n">image</span><span class="o">=</span><span class="n">ngin</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="o">/</span><span class="n">nginx</span> <span class="n">created</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">describe</span> <span class="n">po</span> <span class="n">nginx</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">default</span>
</span></span><span class="line"><span class="cl"><span class="n">Namespace</span><span class="p">:</span>        <span class="n">default</span>
</span></span><span class="line"><span class="cl"><span class="n">Service</span> <span class="n">Account</span><span class="p">:</span>  <span class="n">default</span>
</span></span><span class="line"><span class="cl">  <span class="n">Normal</span>   <span class="n">Scheduled</span>  <span class="mi">104</span><span class="n">s</span>                <span class="n">default</span><span class="o">-</span><span class="n">scheduler</span>  <span class="n">Successfully</span> <span class="n">assigned</span> <span class="n">default</span><span class="o">/</span><span class="n">nginx</span> <span class="n">to</span> <span class="n">controlplane</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Default</span> <span class="n">volume</span> <span class="ow">and</span> <span class="n">mount</span> <span class="n">are</span> <span class="n">automatically</span> <span class="n">created</span> <span class="n">at</span> <span class="err">`</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/*</span><span class="err">`</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Kubernetes</span> <span class="n">automatically</span> <span class="n">mounts</span> <span class="n">the</span> <span class="n">default</span> <span class="n">service</span> <span class="n">account</span> <span class="n">token</span> <span class="n">to</span> <span class="n">inside</span> <span class="n">pode</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">ServiceAccount</span> <span class="n">token</span> <span class="n">Secrets</span> <span class="n">store</span> <span class="n">credentials</span> <span class="n">identifying</span> <span class="n">a</span> <span class="n">ServiceAccount</span> <span class="k">for</span> <span class="n">Pods</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Legacy</span> <span class="n">method</span> <span class="n">providing</span> <span class="n">long</span><span class="o">-</span><span class="n">lived</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">but</span> <span class="n">In</span> <span class="n">Kubernetes</span> <span class="n">v1</span><span class="mf">.22</span><span class="o">+</span><span class="p">,</span> <span class="n">recommended</span> <span class="n">to</span> <span class="n">obtain</span> <span class="n">short</span><span class="o">-</span><span class="n">lived</span><span class="p">,</span> <span class="n">rotating</span> <span class="n">tokens</span> <span class="n">using</span> <span class="err">`</span><span class="n">TokenRequest</span> <span class="n">API</span><span class="err">`</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Methods</span> <span class="n">to</span> <span class="n">obtain</span> <span class="n">short</span><span class="o">-</span><span class="n">lived</span> <span class="n">tokens</span> <span class="n">include</span> <span class="n">direct</span> <span class="n">API</span> <span class="n">calls</span> <span class="ow">or</span> <span class="n">through</span> <span class="n">kubectl</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">```</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">describe</span> <span class="n">po</span> <span class="n">nginx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span><span class="n">elipsis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Containers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">nginx</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Container</span> <span class="n">ID</span><span class="p">:</span>   
</span></span><span class="line"><span class="cl">    <span class="n">Image</span><span class="p">:</span>          <span class="n">ngin</span>
</span></span><span class="line"><span class="cl">    <span class="n">Image</span> <span class="n">ID</span><span class="p">:</span>       
</span></span><span class="line"><span class="cl">    <span class="n">Port</span><span class="p">:</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Host</span> <span class="n">Port</span><span class="p">:</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">State</span><span class="p">:</span>          <span class="n">Waiting</span>
</span></span><span class="line"><span class="cl">      <span class="n">Reason</span><span class="p">:</span>       <span class="n">ErrImagePull</span>
</span></span><span class="line"><span class="cl">    <span class="n">Ready</span><span class="p">:</span>          <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">Restart</span> <span class="n">Count</span><span class="p">:</span>  <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">Environment</span><span class="p">:</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Mounts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span> <span class="kn">from</span> <span class="nn">kube</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">access</span><span class="o">-</span><span class="mi">2</span><span class="n">pp72</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Volumes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">kube</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">access</span><span class="o">-</span><span class="mi">2</span><span class="n">pp72</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Type</span><span class="p">:</span>                    <span class="n">Projected</span> <span class="p">(</span><span class="n">a</span> <span class="n">volume</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">injected</span> <span class="n">data</span> <span class="kn">from</span> <span class="nn">multiple</span> <span class="n">sources</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">TokenExpirationSeconds</span><span class="p">:</span>  <span class="mi">3607</span>
</span></span><span class="line"><span class="cl">    <span class="n">ConfigMapName</span><span class="p">:</span>           <span class="n">kube</span><span class="o">-</span><span class="n">root</span><span class="o">-</span><span class="n">ca</span><span class="o">.</span><span class="n">crt</span>
</span></span><span class="line"><span class="cl">    <span class="n">ConfigMapOptional</span><span class="p">:</span>       <span class="o">&lt;</span><span class="n">nil</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">DownwardAPI</span><span class="p">:</span>             <span class="n">true</span>      
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can check it like this</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">✖</span> <span class="n">k</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">nginx</span> <span class="o">--</span> <span class="n">ls</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span>
</span></span><span class="line"><span class="cl"><span class="n">ca</span><span class="o">.</span><span class="n">crt</span>  <span class="n">namespace</span>  <span class="n">token</span>
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">nginx</span> <span class="o">--</span> <span class="n">cat</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">secrets</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">serviceaccount</span><span class="o">/</span><span class="n">token</span>
</span></span><span class="line"><span class="cl"><span class="n">eyJhbGciOiJSUzI1NiIsImtpZCI6Im1VUi1aZllLak5Fc0MyV184aE1ycDVvcmN6Z1pnNWZlT1JGLXFxQ2NtTm8ifQ</span><span class="o">.</span><span class="n">eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiLCJrM3MiXSwiZXhwIjoxNzQ2MzQyNzYzLCJpYXQiOjE3MTQ4MDY3NjMsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0IiwicG9kIjp7Im5hbWUiOiJuZ2lueCIsInVpZCI6ImRjNjgzOTI0LTZmYjAtNGFlOC04YjNmLTRlZmU5NmEwMjI0YSJ9LCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoiZGVmYXVsdCIsInVpZCI6IjgxY2M0MDU1LTBhNjAtNDNiNC05ODE3LTk3OWIwYTUwODA3MiJ9LCJ3YXJuYWZ0ZXIiOjE3MTQ4MTAzNzB9LCJuYmYiOjE3MTQ4MDY3NjMsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ</span><span class="o">.</span><span class="n">KOu1urbQ_aqLSDe0tOChy9ZbEmeUFkf</span><span class="o">-</span><span class="n">yDKU0TPeK_zKqi1tbZRGV4pVY_6ac90ZCeWTTu2hA1jsUYFTLVyfWfCy7jb7H7BR3gBVrMnUncSYIbjGeZNuJK_3JJ_xaSN3cuKJyJbK19cQG19pACkp3TvPxXfmdAKFcuGXdpvp9m4vXGGHV4zMKebStuk5guhKyDsVQycoLSTse4mUohARPRb8BFTNcSTwUHaQ2crTo</span><span class="o">-</span><span class="n">FBa46XbwQUkQt0JTIeCijXb9cRe0zvuiZggUEv2i8BBVb6G6OAVt9n5uzYAv4WLSSF8ovfygbQhivq5U</span><span class="o">-</span><span class="n">BJP7B85IaEKwuejLDzMthXa9ioA</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-sa-policy.png"
        data-srcset="/images/k8s-sa-policy.png, /images/k8s-sa-policy.png 1.5x, /images/k8s-sa-policy.png 2x"
        data-sizes="auto"
        alt="/images/k8s-sa-policy.png"
        title="/images/k8s-sa-policy.png" /></p>
<p>Unlike the existing method on the left where a secret and a token were created when creating sa, from 1.24 onwards, you must explicitly create a token instead of creating a secret to confirm it. Also, if necessary, you must create a secret as shown below and connect to sa.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-sa-policy2.png"
        data-srcset="/images/k8s-sa-policy2.png, /images/k8s-sa-policy2.png 1.5x, /images/k8s-sa-policy2.png 2x"
        data-sizes="auto"
        alt="/images/k8s-sa-policy2.png"
        title="/images/k8s-sa-policy2.png" /></p>
<blockquote>
<p><a href="https://kubernetes.io/docs/concepts/configuration/secret/#serviceaccount-token-secrets" target="_blank" rel="noopener noreffer">But, Note: You should only create a ServiceAccount token Secret if you can&rsquo;t use the TokenRequest API to obtain a token, and the security exposure of persisting a non-expiring token credential in a readable API object is acceptable to you. For instructions, see Manually create a long-lived API token for a ServiceAccount.</a>
</p>
</blockquote>
<h2 id="image-security">Image security</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">create</span> <span class="n">secret</span> <span class="o">-</span><span class="n">h</span>
</span></span><span class="line"><span class="cl"><span class="n">Create</span> <span class="n">a</span> <span class="n">secret</span> <span class="k">with</span> <span class="n">specified</span> <span class="nb">type</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">A</span> <span class="n">docker</span><span class="o">-</span><span class="n">registry</span> <span class="nb">type</span> <span class="n">secret</span> <span class="ow">is</span> <span class="k">for</span> <span class="n">accessing</span> <span class="n">a</span> <span class="n">container</span> <span class="n">registry</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">A</span> <span class="n">generic</span> <span class="nb">type</span> <span class="n">secret</span> <span class="n">indicate</span> <span class="n">an</span> <span class="n">Opaque</span> <span class="n">secret</span> <span class="nb">type</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">A</span> <span class="n">tls</span> <span class="nb">type</span> <span class="n">secret</span> <span class="n">holds</span> <span class="n">TLS</span> <span class="n">certificate</span> <span class="ow">and</span> <span class="n">its</span> <span class="n">associated</span> <span class="n">key</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Available</span> <span class="n">Commands</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">docker</span><span class="o">-</span><span class="n">registry</span>   <span class="n">Create</span> <span class="n">a</span> <span class="n">secret</span> <span class="k">for</span> <span class="n">use</span> <span class="k">with</span> <span class="n">a</span> <span class="n">Docker</span> <span class="n">registry</span>
</span></span><span class="line"><span class="cl">  <span class="n">generic</span>           <span class="n">Create</span> <span class="n">a</span> <span class="n">secret</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">local</span> <span class="n">file</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="ow">or</span> <span class="n">literal</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">  <span class="n">tls</span>               <span class="n">Create</span> <span class="n">a</span> <span class="n">TLS</span> <span class="n">secret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Create a secret object with the credentials required to access the registry.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Name: private-reg-cred
</span></span><span class="line"><span class="cl">Username: dock_user
</span></span><span class="line"><span class="cl">Password: dock_password
</span></span><span class="line"><span class="cl">Server: myprivateregistry.com:5000
</span></span><span class="line"><span class="cl">Email: dock_user@myprivateregistry.com
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">create</span> <span class="n">secret</span> <span class="n">docker</span><span class="o">-</span><span class="n">registry</span> <span class="n">private</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">cred</span> <span class="o">--</span><span class="n">docker</span><span class="o">-</span><span class="n">username</span><span class="o">=</span><span class="n">dock_user</span> <span class="o">--</span><span class="n">docker_email</span><span class="o">=</span><span class="n">dock_user</span><span class="nd">@myprivateregistry.com</span> <span class="o">--</span><span class="n">docker</span><span class="o">-</span><span class="n">password</span><span class="o">=</span><span class="n">dock_password</span> <span class="o">--</span><span class="n">docker</span><span class="o">-</span><span class="n">server</span><span class="o">=</span><span class="n">myprivateregistry</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">5000</span>
</span></span><span class="line"><span class="cl"><span class="n">secret</span><span class="o">/</span><span class="n">private</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">cred</span> <span class="n">created</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">get</span> <span class="n">secret</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>               <span class="n">TYPE</span>                             <span class="n">DATA</span>   <span class="n">AGE</span>
</span></span><span class="line"><span class="cl"><span class="n">private</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">cred</span>   <span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">dockerconfigjson</span>   <span class="mi">1</span>      <span class="mi">6</span><span class="n">s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@controlplane</span> <span class="o">~</span> <span class="err">✖</span> <span class="n">k</span> <span class="n">describe</span> <span class="n">secret</span> <span class="n">private</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">cred</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span>         <span class="n">private</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">cred</span>
</span></span><span class="line"><span class="cl"><span class="n">Namespace</span><span class="p">:</span>    <span class="n">default</span>
</span></span><span class="line"><span class="cl"><span class="n">Labels</span><span class="p">:</span>       <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Annotations</span><span class="p">:</span>  <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Type</span><span class="p">:</span>  <span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">dockerconfigjson</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Data</span>
</span></span><span class="line"><span class="cl"><span class="o">====</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">dockerconfigjson</span><span class="p">:</span>  <span class="mi">176</span> <span class="nb">bytes</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>edit deployment</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">root</span><span class="nd">@controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">edit</span> <span class="n">deployments</span><span class="o">.</span><span class="n">apps</span> <span class="n">web</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">spec</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">containers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="o">-</span> <span class="n">image</span><span class="p">:</span> <span class="n">myprivateregistry</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">nginx</span><span class="p">:</span><span class="n">alpine</span>
</span></span><span class="line"><span class="cl">        <span class="n">imagePullPolicy</span><span class="p">:</span> <span class="n">IfNotPresent</span>
</span></span><span class="line"><span class="cl">        <span class="n">imagePullSecrets</span><span class="p">:</span> <span class="n">private</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">cred</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">error</span><span class="p">:</span> <span class="n">deployments</span><span class="o">.</span><span class="n">apps</span> <span class="s2">&#34;web&#34;</span> <span class="ow">is</span> <span class="n">invalid</span>
</span></span><span class="line"><span class="cl"><span class="n">A</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">your</span> <span class="n">changes</span> <span class="n">has</span> <span class="n">been</span> <span class="n">stored</span> <span class="n">to</span> <span class="s2">&#34;/tmp/kubectl-edit-4288536569.yaml&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">error</span><span class="p">:</span> <span class="n">Edit</span> <span class="n">cancelled</span><span class="p">,</span> <span class="n">no</span> <span class="n">valid</span> <span class="n">changes</span> <span class="n">were</span> <span class="n">saved</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">vim</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">kubectl</span><span class="o">-</span><span class="n">edit</span><span class="o">-</span><span class="mf">4288536569.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">spec</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">imagePullSecrets</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">private</span><span class="o">-</span><span class="n">reg</span><span class="o">-</span><span class="n">cred</span>
</span></span><span class="line"><span class="cl">      <span class="n">containers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="o">-</span> <span class="n">image</span><span class="p">:</span> <span class="n">myprivateregistry</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">nginx</span><span class="p">:</span><span class="n">alpine</span>
</span></span><span class="line"><span class="cl">        <span class="n">imagePullPolicy</span><span class="p">:</span> <span class="n">IfNotPresent</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">k</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">kubectl</span><span class="o">-</span><span class="n">edit</span><span class="o">-</span><span class="mf">4288536569.</span><span class="n">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="security-context">Security Context</h2>
<blockquote>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" target="_blank" rel="noopener noreffer">https://kubernetes.io/docs/tasks/configure-pod-container/security-context/</a>
</p>
</blockquote>
<p>A security context defines privilege and access control settings for a Pod or Container.</p>
<ul>
<li><code>pod.spec.securityContext</code></li>
<li><code>pod.spec.containers.securityContext</code></li>
</ul>
<h4 id="attributes">Attributes</h4>
<ul>
<li><code>runAsGroup</code></li>
<li><code>runAsUser</code></li>
<li><code>capabilities</code>: Adds and removes POSIX capabilities from running containers.</li>
</ul>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod" target="_blank" rel="noopener noreffer">The runAsGroup field specifies the primary group ID of &lt;runAsGroup_value&gt; for all processes within any containers of the Pod. If this field is omitted, the primary group ID of the containers will be root(0).</a>
</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">ps</span> <span class="o">-</span><span class="n">ef</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">sleep</span>
</span></span><span class="line"><span class="cl"> <span class="mi">6747</span> <span class="n">root</span>      <span class="mi">0</span><span class="p">:</span><span class="mi">00</span> <span class="n">sleep</span> <span class="mi">4800</span>
</span></span><span class="line"><span class="cl"> <span class="mi">7688</span> <span class="n">root</span>      <span class="mi">0</span><span class="p">:</span><span class="mi">00</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">sleep</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">sleeper</span> <span class="o">--</span> <span class="n">ps</span> <span class="o">-</span><span class="n">ef</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">sleep</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span>           <span class="mi">1</span>       <span class="mi">0</span>  <span class="mi">0</span> <span class="mi">09</span><span class="p">:</span><span class="mi">17</span> <span class="err">?</span>        <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">sleep</span> <span class="mi">4800</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="how-to-check-capabilities">How to check capabilities</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">sleeper</span> <span class="o">--</span> <span class="n">sh</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ls</span>
</span></span><span class="line"><span class="cl"><span class="nb">bin</span>  <span class="n">boot</span>  <span class="n">dev</span>  <span class="n">etc</span>  <span class="n">home</span>  <span class="n">lib</span>  <span class="n">lib64</span>  <span class="n">media</span>  <span class="n">mnt</span>  <span class="n">opt</span>  <span class="n">proc</span>  <span class="n">root</span>  <span class="n">run</span>  <span class="n">sbin</span>  <span class="n">srv</span>  <span class="n">sys</span>  <span class="n">tmp</span>  <span class="n">usr</span>  <span class="n">var</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ps -aux</span>
</span></span><span class="line"><span class="cl"><span class="n">USER</span>         <span class="n">PID</span> <span class="o">%</span><span class="n">CPU</span> <span class="o">%</span><span class="n">MEM</span>    <span class="n">VSZ</span>   <span class="n">RSS</span> <span class="n">TTY</span>      <span class="n">STAT</span> <span class="n">START</span>   <span class="n">TIME</span> <span class="n">COMMAND</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span>           <span class="mi">1</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>   <span class="mi">2692</span>  <span class="mi">1120</span> <span class="err">?</span>        <span class="n">Ss</span>   <span class="mi">04</span><span class="p">:</span><span class="mi">13</span>   <span class="mi">0</span><span class="p">:</span><span class="mi">00</span> <span class="n">sleep</span> <span class="mi">4800</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span>          <span class="mi">56</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>   <span class="mi">2796</span>  <span class="mi">1096</span> <span class="n">pts</span><span class="o">/</span><span class="mi">0</span>    <span class="n">Ss</span>   <span class="mi">04</span><span class="p">:</span><span class="mi">15</span>   <span class="mi">0</span><span class="p">:</span><span class="mi">00</span> <span class="n">sh</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span>          <span class="mi">63</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>   <span class="mi">7884</span>  <span class="mi">4112</span> <span class="n">pts</span><span class="o">/</span><span class="mi">0</span>    <span class="n">R</span><span class="o">+</span>   <span class="mi">04</span><span class="p">:</span><span class="mi">15</span>   <span class="mi">0</span><span class="p">:</span><span class="mi">00</span> <span class="n">ps</span> <span class="o">-</span><span class="n">aux</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">cd</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">cat</span> <span class="n">status</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">Cap</span>
</span></span><span class="line"><span class="cl"><span class="n">CapInh</span><span class="p">:</span> <span class="mi">0000000000000000</span>
</span></span><span class="line"><span class="cl"><span class="n">CapPrm</span><span class="p">:</span> <span class="mi">00000000</span><span class="n">a80425fb</span>
</span></span><span class="line"><span class="cl"><span class="n">CapEff</span><span class="p">:</span> <span class="mi">00000000</span><span class="n">a80425fb</span>
</span></span><span class="line"><span class="cl"><span class="n">CapBnd</span><span class="p">:</span> <span class="mi">00000000</span><span class="n">a80425fb</span>
</span></span><span class="line"><span class="cl"><span class="n">CapAmb</span><span class="p">:</span> <span class="mi">0000000000000000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># edit pod.spec.securityContext.capabilities</span>
</span></span><span class="line"><span class="cl"><span class="n">k</span> <span class="n">edit</span> <span class="n">po</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">sleeper</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="network-policies">Network policies</h2>
<blockquote>
<p><a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" target="_blank" rel="noopener noreffer">https://kubernetes.io/docs/concepts/services-networking/network-policies/</a>
</p>
</blockquote>
<ul>
<li>By default, a pod is non-isolated for egress and ingress, which means default is all allowed</li>
<li>Only traffic flows marked as &ldquo;Ingress&rdquo; or &ldquo;Egress&rdquo; in <code>spec.PolicyTypes</code> are impacted by network policy.</li>
<li>If ingress is allowed, a response to the request is automatically delivered.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network-policy1.png"
        data-srcset="/images/k8s-network-policy1.png, /images/k8s-network-policy1.png 1.5x, /images/k8s-network-policy1.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network-policy1.png"
        title="/images/k8s-network-policy1.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network-policy2.png"
        data-srcset="/images/k8s-network-policy2.png, /images/k8s-network-policy2.png 1.5x, /images/k8s-network-policy2.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network-policy2.png"
        title="/images/k8s-network-policy2.png" /></p>
<blockquote>
<p><a href="https://github.com/ahmetb/kubernetes-network-policy-recipes/blob/master/09-allow-traffic-only-to-a-port.md" target="_blank" rel="noopener noreffer">kubernetes-network-policy-recipes</a>
</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">NetworkPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">api-allow-5000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">apiserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ingress</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">5000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">from</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">podSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">monitoring</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Drop all non-whitelisted traffic to app=apiserver.</li>
<li><strong>Allow traffic on port 5000 from pods with label role=monitoring in the same namespace.</strong></li>
</ul>
<h4 id="problem">Problem</h4>
<blockquote>
<p>Use the spec given below. You might want to enable ingress traffic to the pod to test your rules in the UI.Also, ensure that you allow egress traffic to DNS ports TCP and UDP (port 53) to enable DNS resolution from the internal pod.</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Policy Name: internal-policy
</span></span><span class="line"><span class="cl">Policy Type: Egress
</span></span><span class="line"><span class="cl">Egress Allow: payroll
</span></span><span class="line"><span class="cl">Payroll Port: 8080
</span></span><span class="line"><span class="cl">Egress Allow: mysql
</span></span><span class="line"><span class="cl">MySQL Port: 3306
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">controlplane ~ ➜  k get all
</span></span><span class="line"><span class="cl">NAME           READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">pod/external   1/1     Running   0          23m
</span></span><span class="line"><span class="cl">pod/internal   1/1     Running   0          23m
</span></span><span class="line"><span class="cl">pod/mysql      1/1     Running   0          23m
</span></span><span class="line"><span class="cl">pod/payroll    1/1     Running   0          23m
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
</span></span><span class="line"><span class="cl">service/db-service         ClusterIP   10.97.124.55     &lt;none&gt;        3306/TCP         23m
</span></span><span class="line"><span class="cl">service/external-service   NodePort    10.102.212.250   &lt;none&gt;        8080:30080/TCP   23m
</span></span><span class="line"><span class="cl">service/internal-service   NodePort    10.107.186.112   &lt;none&gt;        8080:30082/TCP   23m
</span></span><span class="line"><span class="cl">service/kubernetes         ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP          105m
</span></span><span class="line"><span class="cl">service/payroll-service    NodePort    10.103.183.130   &lt;none&gt;        8080:30083/TCP   23m
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="solution-1">Solution</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">k</span> <span class="n">get</span> <span class="n">netpol</span> <span class="n">payroll</span><span class="o">-</span><span class="n">policy</span> <span class="o">-</span><span class="n">o</span> <span class="n">yaml</span> <span class="o">&gt;</span> <span class="n">netpol</span><span class="o">.</span><span class="n">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>netpol.yaml</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">networking.k8s.io/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">NetworkPolicy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">internal-policy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">egress</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">to</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">podSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">payroll</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">to</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">podSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">mysql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">3306</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">53</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">UDP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">53</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">podSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">internal</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">policyTypes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">Egress</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">k</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">netpol</span><span class="o">.</span><span class="n">yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="chapter-8-storage">Chapter 8: Storage</h1>
<ul>
<li><a href="https://docs.docker.com/storage/storagedriver/#storage-drivers-versus-docker-volumes" target="_blank" rel="noopener noreffer">Docker: Storage drivers versus Docker volumes</a>
</li>
</ul>
<p>As we start learning about containerization, we come across two important parts: storage drivers and volumes. These are crucial for managing data in Docker setups. Storage drivers handle storing image layers and container data, aiming for efficiency while considering performance. Volumes, on the other hand, provide a way to store data persistently, connecting the temporary nature of containers with the need for lasting data storage and sharing. In this discussion, we&rsquo;ll explore the key differences between storage drivers and volumes, understand why memory efficiency and Copy-on-Write (CoW) mechanisms matter for storage drivers, and see how volume drivers help keep data stored across container lifetimes. Let&rsquo;s summarize Docker storage and volume together.</p>
<p>Containers are designed with a stateless assumption to facilitate reuse. Docker, not only for container reuse but also for efficient image building, divides images into layers. These layers enable reuse as the created image is read-only (RO).</p>
<p>However, containers created from images can write and modify files. This occurs through Copy-on-Write (COW) functionality, where changes made in the layer trigger a copy and write process in the background. Storage drivers handle this role.</p>
<p>Storage drivers need to be memory efficient and support COW, but they can impact performance, especially with large data IO operations like databases (db). To address this, volumes are used. Volumes ensure persistence beyond container lifespan and enable data sharing between containers. Depending on the driver, data can be stored in cloud or node hosts.</p>
<h3 id="ko">ko</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">- container는 재사용하기 위해 stateless를 가정한다.
</span></span><span class="line"><span class="cl">- docker는 container 재사용 뿐 아니라, image build 효율을 위해 image 각각에도 layer를 나눠서 관리한다.
</span></span><span class="line"><span class="cl">- 만들어진 image는 RO(stateless)이기 때문에 재사용 가능하다.
</span></span><span class="line"><span class="cl">- 하지만 image를 통해 만들어진 container는 파일을 쓰고 고칠수도 있다. 이는 COW, 실제 해당 layer에서 Write이 일어날때 copy 후 write하기 때문이며, 이 기능은 background에서 일어난다. 이 역할을 하는 것이 storage driver이다.
</span></span><span class="line"><span class="cl">- storage driver는 기본적으로 memory efficiend하게 만들어져야 하며, cow를 제공해야 하기 때문에 큰 데이터 IO의 경우(db) 성능에 안좋은 영향을 받는다.
</span></span><span class="line"><span class="cl">- 그렇기 때문에 Volume을 사용한다. volume은 persist를 위해 사용하며, container lifespan을 벗어난 데이터들을 관리할 수도 있고, container간에 share도 가능하다. driver에 따라서 cloud, node host에 저장할 수도 있다.
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="csi-container-storage-interface">CSI (container storage interface)</h2>
<ul>
<li>CRI: container runtime interface</li>
<li>CNI: container network interface</li>
<li><a href="https://github.com/container-storage-interface/spec/blob/master/spec.md" target="_blank" rel="noopener noreffer">CSI</a>
: container storage interface</li>
</ul>
<h2 id="volume">Volume</h2>
<p>Kubernetes volumes preserve container data, preventing loss on crashes, enabling file sharing in Pods, and enhancing application management by providing directories accessible to containers with various types, including ephemeral and persistent, ensuring data persistence across restarts.</p>
<h2 id="persistent-volume">Persistent Volume</h2>
<p>Volume have to write spec on pod definition, but when system is bigger than It is hard to manage all pods to mapping each volumes. So persistent volume and Persistent volume claim concepts are invented.</p>
<blockquote>
<p>Configure a volume to store these logs at /var/log/webapp on the host.</p>
</blockquote>
<ul>
<li>spec</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">Name</span><span class="p">:</span> <span class="n">webapp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="ne">Image</span> <span class="n">Name</span><span class="p">:</span> <span class="n">kodekloud</span><span class="o">/</span><span class="n">event</span><span class="o">-</span><span class="n">simulator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Volume</span> <span class="n">HostPath</span><span class="p">:</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">webapp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Volume</span> <span class="n">Mount</span><span class="p">:</span> <span class="o">/</span><span class="nb">log</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">k</span> <span class="n">get</span> <span class="nb">all</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>         <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="o">/</span><span class="n">webapp</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">5</span><span class="n">m26s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>                 <span class="n">TYPE</span>        <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>   <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>   <span class="n">AGE</span>
</span></span><span class="line"><span class="cl"><span class="n">service</span><span class="o">/</span><span class="n">kubernetes</span>   <span class="n">ClusterIP</span>   <span class="mf">10.96.0.1</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">443</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">11</span><span class="n">m</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">k</span> <span class="n">get</span> <span class="n">po</span> <span class="n">webapp</span> <span class="o">-</span><span class="n">o</span> <span class="n">yaml</span> <span class="o">&gt;</span> <span class="n">webapp</span><span class="o">.</span><span class="n">yaml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># edit</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="n">k</span> <span class="n">replace</span> <span class="o">-</span><span class="n">f</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">webapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">event-simulator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">kodekloud/event-simulator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">LOG_HANDLERS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">log-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">log-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># directory location on host</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/log/webapp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># this field is optional</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Directory</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Should volumeMounts.name == volumes.name</li>
<li>not hostpath, hostPath</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pv-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Retain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteMany</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">100Mi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/pv/log</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes-1" target="_blank" rel="noopener noreffer"><strong>Claims use the same conventions as volumes when requesting storage with specific access modes.</strong></a>
</li>
</ul>
<h2 id="persistent-volume-claims">Persistent Volume Claims</h2>
<ol>
<li>PVC created</li>
<li>k8s search for matching pv (pending state pvc)</li>
<li>Bind</li>
</ol>
<h2 id="storage-class">Storage Class</h2>
<p><strong>It would be great if make pv then physical memory provisioned, which is called <code>Dynamic Provisioning</code>. And we can achieve it by <code>Storage class(sc)</code> instead PV. Actually pv is created when sc definition is called but we do not manually create pv, because we need to manage volume dynamically.</strong></p>
<h2 id="wrap-up">Wrap up</h2>
<ol>
<li>PV: provision된 physical volume을 관리하는 instance  (node처럼 cluster resource)</li>
<li>PVC: volume를 쓰기위한 요청. <strong>pod는 pvc를 통해 pv에 리소스 사용</strong></li>
<li>StorageClass(sc)</li>
</ol>
<ul>
<li>PVC와 PV는 같은 storageClassName일 때 bind</li>
<li>물론 default storageClass가 있으면 storageClassName omit가능</li>
</ul>
<p><strong>PV를 프로비저닝 하는 방법은 총 2가지이다.</strong></p>
<ol>
<li>Static Provisioning</li>
</ol>
<ul>
<li>kube-apisesrver를 통해서 (kubectl) admin(관리자)이 직접 pv를 생성하는 방식</li>
</ul>
<ol start="2">
<li>Dynamic Provisioning</li>
</ol>
<ul>
<li>storage class를 기반으로 자동으로 pv를 생성하여 provision하는 방식</li>
<li><strong>PVC가 특정 spec을 정의한 storage class를 요청하면 pvc의 양만큼 sc에 정의된 스펙의 pv가 생성되고 프로비저닝 된다.</strong></li>
</ul>
<h1 id="chapter-9-networking">Chapter 9: Networking</h1>
<h2 id="switching-routing">Switching Routing</h2>
<h4 id="switching">Switching</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ip</span> <span class="n">addr</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ip</span> <span class="n">address</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">ip</span> <span class="n">address</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span><span class="p">:</span> <span class="n">lo</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">65536</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UNKNOWN</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="cl">    <span class="n">link</span><span class="o">/</span><span class="n">loopback</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">brd</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
</span></span><span class="line"><span class="cl">    <span class="n">inet</span> <span class="mf">127.0.0.1</span><span class="o">/</span><span class="mi">8</span> <span class="n">scope</span> <span class="n">host</span> <span class="n">lo</span>
</span></span><span class="line"><span class="cl">       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span><span class="p">:</span> <span class="n">flannel</span><span class="mf">.1</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1400</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UNKNOWN</span> <span class="n">group</span> <span class="n">default</span> 
</span></span><span class="line"><span class="cl">    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">7</span><span class="n">e</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="mi">9</span><span class="n">a</span><span class="p">:</span><span class="mi">1</span><span class="n">e</span><span class="p">:</span><span class="n">dc</span><span class="p">:</span><span class="mi">79</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
</span></span><span class="line"><span class="cl">    <span class="n">inet</span> <span class="mf">10.244.0.0</span><span class="o">/</span><span class="mi">32</span> <span class="n">scope</span> <span class="k">global</span> <span class="n">flannel</span><span class="mf">.1</span>
</span></span><span class="line"><span class="cl">       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</span></span><span class="line"><span class="cl"><span class="mi">3</span><span class="p">:</span> <span class="n">cni0</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1400</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">group</span> <span class="n">default</span> <span class="n">qlen</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="cl">    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">8</span><span class="n">e</span><span class="p">:</span><span class="n">a7</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="n">ce</span><span class="p">:</span><span class="mi">4</span><span class="n">f</span><span class="p">:</span><span class="mi">34</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span>
</span></span><span class="line"><span class="cl">    <span class="n">inet</span> <span class="mf">10.244.0.1</span><span class="o">/</span><span class="mi">24</span> <span class="n">brd</span> <span class="mf">10.244.0.255</span> <span class="n">scope</span> <span class="k">global</span> <span class="n">cni0</span>
</span></span><span class="line"><span class="cl">       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="p">:</span> <span class="n">veth94e4cabd</span><span class="nd">@if2</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1400</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">master</span> <span class="n">cni0</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">group</span> <span class="n">default</span> 
</span></span><span class="line"><span class="cl">    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="n">ca</span><span class="p">:</span><span class="n">df</span><span class="p">:</span><span class="mi">3</span><span class="n">d</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="n">bb</span><span class="p">:</span><span class="mi">96</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netns</span> <span class="n">cni</span><span class="o">-</span><span class="n">cf9503cc</span><span class="o">-</span><span class="n">e140</span><span class="o">-</span><span class="mi">55</span><span class="n">a0</span><span class="o">-</span><span class="mi">5</span><span class="n">d1b</span><span class="o">-</span><span class="n">f0475dc95336</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span><span class="p">:</span> <span class="n">veth58ee9409</span><span class="nd">@if2</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1400</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">master</span> <span class="n">cni0</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">group</span> <span class="n">default</span> 
</span></span><span class="line"><span class="cl">    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="n">b2</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="mi">5</span><span class="n">b</span><span class="p">:</span><span class="n">bd</span><span class="p">:</span><span class="n">ca</span><span class="p">:</span><span class="mi">14</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netns</span> <span class="n">cni</span><span class="o">-</span><span class="mi">908</span><span class="n">defd9</span><span class="o">-</span><span class="mi">94</span><span class="n">bd</span><span class="o">-</span><span class="mi">1</span><span class="n">a21</span><span class="o">-</span><span class="mi">0282</span><span class="o">-</span><span class="mi">6</span><span class="n">ad3f832bc73</span>
</span></span><span class="line"><span class="cl"><span class="mi">13028</span><span class="p">:</span> <span class="n">eth0</span><span class="nd">@if13029</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1450</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">group</span> <span class="n">default</span> 
</span></span><span class="line"><span class="cl">    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">02</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="n">c0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="n">f3</span><span class="p">:</span><span class="mi">09</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netnsid</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">inet</span> <span class="mf">192.0.243.9</span><span class="o">/</span><span class="mi">24</span> <span class="n">brd</span> <span class="mf">192.0.243.255</span> <span class="n">scope</span> <span class="k">global</span> <span class="n">eth0</span>
</span></span><span class="line"><span class="cl">       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</span></span><span class="line"><span class="cl"><span class="mi">13030</span><span class="p">:</span> <span class="n">eth1</span><span class="nd">@if13031</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">group</span> <span class="n">default</span> 
</span></span><span class="line"><span class="cl">    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mi">02</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="n">ac</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">15</span> <span class="n">brd</span> <span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">ff</span> <span class="n">link</span><span class="o">-</span><span class="n">netnsid</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">inet</span> <span class="mf">172.25.0.21</span><span class="o">/</span><span class="mi">24</span> <span class="n">brd</span> <span class="mf">172.25.0.255</span> <span class="n">scope</span> <span class="k">global</span> <span class="n">eth1</span>
</span></span><span class="line"><span class="cl">       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>eth0: 과거 디폴트 랜카드 지정 번지 (이더넷 카드 0번)</li>
<li>lo: loopback interface</li>
<li>veth: virtual ethernet interface</li>
<li>ens</li>
<li>em1</li>
<li>MULTICAST: Can handle multicast packet</li>
<li>UP: NUC is working</li>
<li>LOWER_UP: L1 layer, Physical device signal up</li>
<li>mtu: Maximum Transmission Unit (1500 default)</li>
<li>qdisc: Queuing Disciplines, NIC에 들어오기전 Queue에 저장되는 패킷들 우선순위 부여 알고리즘</li>
<li>state: NIC 현재 작동 상태</li>
<li>qlen: 전송큐 크기</li>
<li>link/ether
<ul>
<li>L2 layer, Link layer protocol is ethernet</li>
<li>바로 옆에 나오는 주소는 해당 NIC의 MAC 주소</li>
<li>brd는 브로드캐스트 시 사용되는 주소</li>
</ul>
</li>
<li>inet: L3, 바로 옆 주소는 ipv4 or ipv6에 따른 주소</li>
<li>scope
<ul>
<li><strong>Global</strong>: Indicates accessibility and validity of the interface from a global perspective, allowing access from external networks. This is often seen in instances hosted in the cloud.</li>
<li><strong>Link</strong>: Specifies that the interface is only accessible and valid within the local LAN, restricting access to the local network.</li>
<li><strong>Host</strong>: Indicates that the interface is only valid and accessible within the host itself, limiting access to the local host.</li>
</ul>
</li>
<li>valid_lft, preferred_lft
<ul>
<li>Valid Lifetime and Preferred Lifetime</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="n">add</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="subnet-mask">subnet mask</h4>
<blockquote>
<p><a href="https://www.cloudflare.com/ko-kr/learning/network-layer/what-is-a-subnet/" target="_blank" rel="noopener noreffer">https://www.cloudflare.com/ko-kr/learning/network-layer/what-is-a-subnet/</a>
</p>
</blockquote>
<p>라우터의 정의=&ldquo;서브넷이 다른 네트워크와 연결하기 위해 최적의 경로를 찾아서 목적지까지 패킷을 전달하는 장비&rdquo;</p>
<ol>
<li>IP = 주소가 속한 네트워크 + 해당 네트워크 안의 장치 = subnet + device address</li>
<li>라우터 uses subnet mask to route (cidr)</li>
</ol>
<p>아래 예시는 cidr 적용안된 설명같긴 하다.</p>
<blockquote>
<p>실제 예를 들어, IP 패킷의 주소가 IP 주소 192.0.2.15라고 가정해 보겠습니다. 이 IP 주소는 클래스 C 네트워크이므로 네트워크는 &ldquo;192.0.2&rdquo;(또는 기술적으로는 정확하게 192.0.2.0/24)로 식별됩니다. 네트워크 라우터는 패킷을 &ldquo;192.0.2&quot;라고 표시된 네트워크의 호스트로 전달합니다. 패킷이 해당 네트워크에 도착하면 네트워크 내의 라우터가 라우팅 테이블을 참조합니다.서브넷 마스크 255.255.255.0을 사용하여 이진법 계산을 합니다.장치 주소 &ldquo;15&rdquo;(나머지 IP 주소는 네트워크를 나타냄)를 확인하고 패킷이 이동해야 하는 서브넷을 계산합니다.패킷을 해당 서브넷 내에서 패킷을 전달하는 라우터 또는 스위치로 전달하고 패킷은 IP 주소 192.0.2.15에 도착합니다(라우터 및 스위치에 대해 자세히 알아보기).</p>
</blockquote>
<h4 id="router--gateway">Router / Gateway</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">route</span>
</span></span><span class="line"><span class="cl"><span class="n">Kernel</span> <span class="n">IP</span> <span class="n">routing</span> <span class="n">table</span>
</span></span><span class="line"><span class="cl"><span class="n">Destination</span>     <span class="n">Gateway</span>         <span class="n">Genmask</span>         <span class="n">Flags</span> <span class="n">Metric</span> <span class="n">Ref</span>    <span class="n">Use</span> <span class="n">Iface</span>
</span></span><span class="line"><span class="cl"><span class="n">default</span>         <span class="mf">172.25.0.1</span>      <span class="mf">0.0.0.0</span>         <span class="n">UG</span>    <span class="mi">0</span>      <span class="mi">0</span>        <span class="mi">0</span> <span class="n">eth1</span>
</span></span><span class="line"><span class="cl"><span class="mf">10.244.0.0</span>      <span class="mf">0.0.0.0</span>         <span class="mf">255.255.255.0</span>   <span class="n">U</span>     <span class="mi">0</span>      <span class="mi">0</span>        <span class="mi">0</span> <span class="n">cni0</span>
</span></span><span class="line"><span class="cl"><span class="mf">10.244.1.0</span>      <span class="mf">10.244.1.0</span>      <span class="mf">255.255.255.0</span>   <span class="n">UG</span>    <span class="mi">0</span>      <span class="mi">0</span>        <span class="mi">0</span> <span class="n">flannel</span><span class="mf">.1</span>
</span></span><span class="line"><span class="cl"><span class="mf">172.25.0.0</span>      <span class="mf">0.0.0.0</span>         <span class="mf">255.255.255.0</span>   <span class="n">U</span>     <span class="mi">0</span>      <span class="mi">0</span>        <span class="mi">0</span> <span class="n">eth1</span>
</span></span><span class="line"><span class="cl"><span class="mf">192.0.243.0</span>     <span class="mf">0.0.0.0</span>         <span class="mf">255.255.255.0</span>   <span class="n">U</span>     <span class="mi">0</span>      <span class="mi">0</span>        <span class="mi">0</span> <span class="n">eth0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># when to add</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">route</span> <span class="n">add</span> <span class="mf">192.168.2.0</span><span class="o">/</span><span class="mi">24</span> <span class="n">via</span> <span class="mf">192.168.1.1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="default-destination">Default Destination</h4>
<ul>
<li>same 0.0.0.0, which means any IP addr</li>
<li>internet에 존재하는 다양한 ip들을 일일히 처리 불가, default를 두어 처리한다.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">default         172.25.0.1      0.0.0.0         UG    0      0        0 eth1
</span></span><span class="line"><span class="cl">0.0.0.0
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="what-if-gateway-0000">What if Gateway 0.0.0.0?</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">10.244.0.0      0.0.0.0         255.255.255.0   U     0      0        0 cni0
</span></span></code></pre></td></tr></table>
</div>
</div><p>같은 네트워크 안에 있는 디바이스는 router / Gateway를 타고 가지 않아도 되니, 0.0.0.0값이 gateway에 존재</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network.png"
        data-srcset="/images/k8s-network.png, /images/k8s-network.png 1.5x, /images/k8s-network.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network.png"
        title="/images/k8s-network.png" /></p>
<ul>
<li>To send packets from A to C, two routes need to be set up: <code>A -&gt; B -&gt; C</code> and <code>C -&gt; B -&gt; A</code></li>
<li><strong>In Linux, packets received on eth1 are not automatically forwarded to eth0; this is due to security concerns.</strong></li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network2.png"
        data-srcset="/images/k8s-network2.png, /images/k8s-network2.png 1.5x, /images/k8s-network2.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network2.png"
        title="/images/k8s-network2.png" /></p>
<p>To enable forwarding, you can either set it in <code>/etc/sysctl.conf</code> or temporarily change it by setting <code>/proc/sys/net/ipv4/ip_forward</code> to 1.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s_network_wrap.png"
        data-srcset="/images/k8s_network_wrap.png, /images/k8s_network_wrap.png 1.5x, /images/k8s_network_wrap.png 2x"
        data-sizes="auto"
        alt="/images/k8s_network_wrap.png"
        title="/images/k8s_network_wrap.png" /></p>
<h2 id="dns">DNS</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span>
</span></span><span class="line"><span class="cl"><span class="mf">127.0.0.1</span>       <span class="n">localhost</span>
</span></span><span class="line"><span class="cl"><span class="p">::</span><span class="mi">1</span>     <span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">loopback</span>
</span></span><span class="line"><span class="cl"><span class="n">fe00</span><span class="p">::</span><span class="mi">0</span> <span class="n">ip6</span><span class="o">-</span><span class="n">localnet</span>
</span></span><span class="line"><span class="cl"><span class="n">ff00</span><span class="p">::</span><span class="mi">0</span> <span class="n">ip6</span><span class="o">-</span><span class="n">mcastprefix</span>
</span></span><span class="line"><span class="cl"><span class="n">ff02</span><span class="p">::</span><span class="mi">1</span> <span class="n">ip6</span><span class="o">-</span><span class="n">allnodes</span>
</span></span><span class="line"><span class="cl"><span class="n">ff02</span><span class="p">::</span><span class="mi">2</span> <span class="n">ip6</span><span class="o">-</span><span class="n">allrouters</span>
</span></span><span class="line"><span class="cl"><span class="mf">192.2.61.9</span>      <span class="n">controlplane</span>
</span></span><span class="line"><span class="cl"><span class="mf">10.0.0.6</span> <span class="n">docker</span><span class="o">-</span><span class="n">registry</span><span class="o">-</span><span class="n">mirror</span><span class="o">.</span><span class="n">kodekloud</span><span class="o">.</span><span class="n">com</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ctrl + D to finish</span>
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">cat</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span>
</span></span><span class="line"><span class="cl"><span class="mf">1.1.1.1</span>         <span class="n">test</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>&gt;&gt;</code>: append</p>
</li>
<li>
<p><code>&gt;</code>: change</p>
</li>
<li>
<p><code>/etc/hosts</code>: Domain name mapping</p>
</li>
<li>
<p><code>/etc/resolv.conf</code>: Domain nameserver ip</p>
<ul>
<li>nameserver</li>
<li><strong>search</strong> field</li>
</ul>
</li>
<li>
<p><code>/etc/nsswitch.conf</code>: Order configuration</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">controlplane ~ ➜  cat /etc/nsswitch.conf 
</span></span><span class="line"><span class="cl"># /etc/nsswitch.conf
</span></span><span class="line"><span class="cl">#
</span></span><span class="line"><span class="cl"># Example configuration of GNU Name Service Switch functionality.
</span></span><span class="line"><span class="cl"># If you have the `glibc-doc-reference&#39; and `info&#39; packages installed, try:
</span></span><span class="line"><span class="cl"># `info libc &#34;Name Service Switch&#34;&#39; for information about this file.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">passwd:         files
</span></span><span class="line"><span class="cl">group:          files
</span></span><span class="line"><span class="cl">shadow:         files
</span></span><span class="line"><span class="cl">gshadow:        files
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">hosts:          files dns
</span></span><span class="line"><span class="cl">networks:       files
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">protocols:      db files
</span></span><span class="line"><span class="cl">services:       db files
</span></span><span class="line"><span class="cl">ethers:         db files
</span></span><span class="line"><span class="cl">rpc:            db files
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">netgroup:       nis
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>hostsf를 보면 file -&gt; dns 순으로 해독된다. 즉 /etc/hosts가 먼저 해석된다.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ping</span>
</span></span><span class="line"><span class="cl"><span class="c1"># etc/hosts를 처리하지 않음, dns서버만 처리함</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">nslookup</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">dig</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="coredns">CoreDNS</h2>
<h2 id="namespace">Namespace</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network3.png"
        data-srcset="/images/k8s-network3.png, /images/k8s-network3.png 1.5x, /images/k8s-network3.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network3.png"
        title="/images/k8s-network3.png" /></p>
<p>When the container is created, it has its own private routing table and ARP table, and a virtual Ethernet interface (veth0) is automatically created.</p>
<h4 id="create-netwok-ns">Create Netwok ns</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">add</span> <span class="n">red</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">add</span> <span class="n">blue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span>
</span></span><span class="line"><span class="cl"><span class="n">red</span>
</span></span><span class="line"><span class="cl"><span class="n">blue</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="exec-in-network-ns">Exec in network ns</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">link</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># simpler</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">red</span> <span class="n">link</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="arp">ARP</h4>
<blockquote>
<p>address resolution protocol</p>
</blockquote>
<ul>
<li>동일한 네트워크 내에 존재하는 호스트들의 IP주소와 ethernet 주소(mac 주소)를 확인하는 명령어</li>
<li>즉, 특정 네트워크 내에 어떤 호스트들이 존재하는지를 확인할 수 있는 것이 바로 arp 명령어</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">arp</span> 
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">arp</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network4.png"
        data-srcset="/images/k8s-network4.png, /images/k8s-network4.png 1.5x, /images/k8s-network4.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network4.png"
        title="/images/k8s-network4.png" /></p>
<ul>
<li>Host는 container에 대해서 알 수 없다.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network5.png"
        data-srcset="/images/k8s-network5.png, /images/k8s-network5.png 1.5x, /images/k8s-network5.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network5.png"
        title="/images/k8s-network5.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">add</span> <span class="n">red</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">add</span> <span class="n">blue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span>
</span></span><span class="line"><span class="cl"><span class="n">red</span>
</span></span><span class="line"><span class="cl"><span class="n">blue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># same</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">red</span> <span class="n">link</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ip</span> <span class="n">link</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">arp</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">route</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># link</span>
</span></span><span class="line"><span class="cl"><span class="c1"># i.g ip link add veth0 type veth peer name veth1 (veth0 &lt;-&gt; veth1)</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="n">add</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span> <span class="nb">type</span> <span class="n">veth</span> <span class="n">peer</span> <span class="n">name</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span> <span class="c1"># (veth-red &lt;-&gt; veth-blue)</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span> <span class="n">netns</span> <span class="n">red</span> <span class="o">&amp;&amp;</span> <span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span> <span class="n">netns</span> <span class="n">blue</span> <span class="c1"># set namespace</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># set ip</span>
</span></span><span class="line"><span class="cl"><span class="c1"># dev means device</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">red</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">192.168.15.1</span> <span class="n">dev</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">blue</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">192.168.15.2</span> <span class="n">dev</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># up link (running)</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span>  <span class="o">-</span><span class="n">n</span> <span class="n">red</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span> <span class="n">up</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span>  <span class="o">-</span><span class="n">n</span> <span class="n">blue</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span> <span class="n">up</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ping test</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">netns</span> <span class="n">exec</span> <span class="n">red</span> <span class="n">ping</span> <span class="mf">192.168.15.2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="switch">Switch</h4>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network6.png"
        data-srcset="/images/k8s-network6.png, /images/k8s-network6.png 1.5x, /images/k8s-network6.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network6.png"
        title="/images/k8s-network6.png" /></p>
<p>만약 container들이 많아진다면? switch가 필요하다.( virtual switch )</p>
<ul>
<li><i class="far fa-check-square fa-fw" aria-hidden="true"></i> LINUX BRIDGE</li>
<li>Open vSwitch(ovs)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">debian</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">ip</span> <span class="n">netns</span> <span class="nb">list</span>
</span></span><span class="line"><span class="cl"><span class="n">blue</span>
</span></span><span class="line"><span class="cl"><span class="n">red</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">debian</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">ip</span> <span class="n">netns</span> <span class="n">add</span> <span class="n">v</span><span class="o">-</span><span class="n">net</span><span class="o">-</span><span class="mi">0</span> <span class="nb">type</span> <span class="n">bridge</span>
</span></span><span class="line"><span class="cl"><span class="n">debian</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">ip</span> <span class="n">netns</span> <span class="nb">list</span>
</span></span><span class="line"><span class="cl"><span class="n">v</span><span class="o">-</span><span class="n">net</span><span class="o">-</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">blue</span>
</span></span><span class="line"><span class="cl"><span class="n">red</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">dev</span> <span class="n">v</span><span class="o">-</span><span class="n">net</span><span class="o">-</span><span class="mi">0</span> <span class="n">up</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>veth 타입과 달리 bridge type을 생성하면 자동으로 network namespace도 생성됨</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># delete past cable</span>
</span></span><span class="line"><span class="cl"><span class="c1"># other pair automatically deleted</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span>  <span class="n">red</span> <span class="n">link</span> <span class="k">del</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># create new cable (veth-red &lt;-&gt; veth-red-br)</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="n">add</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span> <span class="nb">type</span> <span class="n">veth</span> <span class="n">peer</span> <span class="n">name</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span><span class="o">-</span><span class="n">br</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="n">add</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span> <span class="nb">type</span> <span class="n">veth</span> <span class="n">peer</span> <span class="n">name</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span><span class="o">-</span><span class="n">br</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># set veth to namespace</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span> <span class="n">netns</span> <span class="n">red</span> <span class="c1"># red</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span><span class="o">-</span><span class="n">br</span> <span class="n">master</span> <span class="n">v</span><span class="o">-</span><span class="n">net</span><span class="o">-</span><span class="mi">0</span> <span class="c1"># bridge</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span> <span class="n">netns</span> <span class="n">blue</span> <span class="c1"># blue</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span><span class="o">-</span><span class="n">br</span> <span class="n">master</span> <span class="n">v</span><span class="o">-</span><span class="n">net</span><span class="o">-</span><span class="mi">0</span> <span class="c1"># bridge</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># set ip</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">red</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">192.168.15.1</span> <span class="n">dev</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">blue</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">192.168.15.1</span> <span class="n">dev</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># up</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">red</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">red</span> <span class="n">up</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">red</span> <span class="n">link</span> <span class="nb">set</span> <span class="n">veth</span><span class="o">-</span><span class="n">blue</span> <span class="n">up</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Set v-net-0 ip address on host namespace</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ping</span> <span class="mf">192.168.15.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Not</span> <span class="n">Reachable</span><span class="err">!</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ip</span> <span class="n">addr</span> <span class="n">add</span> <span class="mf">192.168.15.5</span><span class="o">/</span><span class="mi">24</span> <span class="n">dev</span> <span class="n">v</span><span class="o">-</span><span class="n">net</span><span class="o">-</span><span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ping</span> <span class="mf">192.168.15.1</span> <span class="c1"># red ok</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="route">Route</h4>
<blockquote>
<p>&ldquo;How to ping outside of host network from isolated namespace container?&rdquo;</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network7.png"
        data-srcset="/images/k8s-network7.png, /images/k8s-network7.png 1.5x, /images/k8s-network7.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network7.png"
        title="/images/k8s-network7.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># 1. allow request </span>
</span></span><span class="line"><span class="cl"><span class="c1"># open v-net-0 -&gt; LAN</span>
</span></span><span class="line"><span class="cl"><span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">blue</span> <span class="n">ip</span> <span class="n">route</span> <span class="n">add</span> <span class="mf">192.168.1.0</span><span class="o">/</span><span class="mi">24</span> <span class="n">via</span> <span class="mf">192.168.15.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. allow response</span>
</span></span><span class="line"><span class="cl"><span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="n">POSTROUTING</span> <span class="o">-</span><span class="n">s</span> <span class="mf">192.168.15.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">j</span> <span class="n">MASQUERADE</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Link to internet (route)</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">blue</span> <span class="n">ping</span> <span class="mf">8.8.8.8</span>
</span></span><span class="line"><span class="cl"><span class="n">Connect</span><span class="p">:</span> <span class="n">Network</span> <span class="ow">is</span> <span class="n">unreachable</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">blue</span> <span class="n">route</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span> <span class="n">nothing</span> <span class="n">related</span> <span class="mf">8.8.8.8</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># default to v-net-0</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">blue</span> <span class="n">ip</span> <span class="n">route</span> <span class="n">add</span> <span class="n">default</span> <span class="n">via</span> <span class="mf">192.168.15.5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">ip</span> <span class="o">-</span><span class="n">n</span> <span class="n">blue</span> <span class="n">ping</span> <span class="mf">8.8.8.8</span>
</span></span><span class="line"><span class="cl"><span class="n">success</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Q. Then how to send request from outside host(192.168.1.3) to host&rsquo;s container?</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network8.png"
        data-srcset="/images/k8s-network8.png, /images/k8s-network8.png 1.5x, /images/k8s-network8.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network8.png"
        title="/images/k8s-network8.png" /></p>
<p>A. Set port forwarding rule on Host.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="err">$</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">A</span> <span class="n">PREROUTING</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">80</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">destination</span> <span class="mf">192.168.15.2</span><span class="p">:</span><span class="mi">80</span> <span class="o">-</span><span class="n">j</span> <span class="n">DNAT</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cf-linux-namespace">c.f) Linux namespace</h2>
<p>We need 2 things to isolate network</p>
<ol>
<li>UTS namespace</li>
<li>Network namespace</li>
</ol>
<blockquote>
<p>리눅스 네임스페이스란?
<a href="https://www.44bits.io/ko/keyword/linux-namespace" target="_blank" rel="noopener noreffer">리눅스 네임스페이스는 프로세스를 실행할 때 시스템의 리소스를 분리해서 실행할 수 있도록 도와주는 기능입니다. 한 시스템의 프로세스들은 기본적으로 시스템의 리소스들을 공유해서 실행됩니다. 이를 단일 네임스페이스라고 생각해볼 수 있습니다. 실제로 리눅스에서는 1번 프로세스(init)에 할당되어있는 네임스페이스들을 자식 프로세스들이 모두 공유해서 사용하는 구조로 이루어져있습니다.</a>
</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ ls -al /proc/1/ns
</span></span><span class="line"><span class="cl">total 0
</span></span><span class="line"><span class="cl">dr-x--x--x 2 root root 0 Jan 31 03:47 .
</span></span><span class="line"><span class="cl">dr-xr-xr-x 9 root root 0 Jan 24 14:46 ..
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 03:47 cgroup -&gt; &#39;cgroup:[4026531835]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 03:47 ipc -&gt; &#39;ipc:[4026531839]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 03:47 mnt -&gt; &#39;mnt:[4026531840]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 03:47 net -&gt; &#39;net:[4026531993]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 03:47 pid -&gt; &#39;pid:[4026531836]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 03:47 pid_for_children -&gt; &#39;pid:[4026531836]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 03:47 user -&gt; &#39;user:[4026531837]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 03:47 uts -&gt; &#39;uts:[4026531838]&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls -l /proc/1074/ns
</span></span><span class="line"><span class="cl">total 0
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 04:08 cgroup -&gt; &#39;cgroup:[4026531835]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 04:08 ipc -&gt; &#39;ipc:[4026531839]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 04:08 mnt -&gt; &#39;mnt:[4026531840]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 04:08 net -&gt; &#39;net:[4026531993]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 04:08 pid -&gt; &#39;pid:[4026531836]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 04:08 pid_for_children -&gt; &#39;pid:[4026531836]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 04:08 user -&gt; &#39;user:[4026531837]&#39;
</span></span><span class="line"><span class="cl">lrwxrwxrwx 1 root root 0 Jan 31 04:08 uts -&gt; &#39;uts:[4026531838]&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">diff &lt;(ls -Al /proc/1/ns | awk &#39;{ print $11 }&#39;)  \
</span></span><span class="line"><span class="cl">       &lt;(ls -Al /proc/1074/ns | awk &#39;{ print $11 }&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="uts-namespace">UTS namespace</h3>
<blockquote>
<p><a href="https://www.44bits.io/ko/post/container-network-1-uts-namespace" target="_blank" rel="noopener noreffer">https://www.44bits.io/ko/post/container-network-1-uts-namespace</a>
</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">debian</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">hostname</span>
</span></span><span class="line"><span class="cl"><span class="n">debian</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">debian</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">touch</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">utsns1</span>
</span></span><span class="line"><span class="cl"><span class="n">debian</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">unshare</span> <span class="o">--</span><span class="n">uts</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">utsns1</span> <span class="n">hostname</span> <span class="n">utsns1</span>
</span></span><span class="line"><span class="cl"><span class="n">debian</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">nsenter</span> <span class="o">--</span><span class="n">uts</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">utsns1</span> <span class="n">hostname</span>
</span></span><span class="line"><span class="cl"><span class="n">utsns1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">nsenter</span> <span class="o">--</span><span class="n">uts</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">utsns1</span> <span class="n">bash</span>
</span></span><span class="line"><span class="cl"><span class="n">debian</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sudo</span> <span class="n">nsenter</span> <span class="o">--</span><span class="n">uts</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">utsns1</span> <span class="n">bash</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="nd">@utsns1</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">debian</span><span class="c1"># hostname</span>
</span></span><span class="line"><span class="cl"><span class="n">utsns1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>So we can isolate hostname with these commands.</p>
<ul>
<li><code>unshare</code></li>
<li><code>nsenter</code></li>
</ul>
<h2 id="docker-networking">Docker Networking</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-docker-net0.png"
        data-srcset="/images/k8s-docker-net0.png, /images/k8s-docker-net0.png 1.5x, /images/k8s-docker-net0.png 2x"
        data-sizes="auto"
        alt="/images/k8s-docker-net0.png"
        title="/images/k8s-docker-net0.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-docker-net1.png"
        data-srcset="/images/k8s-docker-net1.png, /images/k8s-docker-net1.png 1.5x, /images/k8s-docker-net1.png 2x"
        data-sizes="auto"
        alt="/images/k8s-docker-net1.png"
        title="/images/k8s-docker-net1.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-docker-net2.png"
        data-srcset="/images/k8s-docker-net2.png, /images/k8s-docker-net2.png 1.5x, /images/k8s-docker-net2.png 2x"
        data-sizes="auto"
        alt="/images/k8s-docker-net2.png"
        title="/images/k8s-docker-net2.png" />
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-docker-net3.png"
        data-srcset="/images/k8s-docker-net3.png, /images/k8s-docker-net3.png 1.5x, /images/k8s-docker-net3.png 2x"
        data-sizes="auto"
        alt="/images/k8s-docker-net3.png"
        title="/images/k8s-docker-net3.png" /></p>
<h2 id="cni-container-networking-interface">CNI (Container Networking Interface)</h2>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" target="_blank" rel="noopener noreffer">CNI addons list</a>
</li>
<li></li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/k8s-network-cmd.png"
        data-srcset="/images/k8s-network-cmd.png, /images/k8s-network-cmd.png 1.5x, /images/k8s-network-cmd.png 2x"
        data-sizes="auto"
        alt="/images/k8s-network-cmd.png"
        title="/images/k8s-network-cmd.png" /></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">link</span> <span class="n">show</span> <span class="n">eth0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We use Containerd as our container runtime. What is the interface/bridge created by Containerd on the controlplane node?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">ip</span> <span class="n">address</span> <span class="n">show</span> <span class="nb">type</span> <span class="n">bridge</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># -t: TCP</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -n: keep number</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -l: listening only</span>
</span></span><span class="line"><span class="cl"><span class="n">netstat</span> <span class="o">-</span><span class="n">nplt</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">scheduler</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">netstat</span> <span class="o">-</span><span class="n">npa</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">etcd</span> <span class="o">|</span> <span class="n">grep</span> <span class="mi">2379</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
</span></span><span class="line"><span class="cl"><span class="mi">63</span>
</span></span><span class="line"><span class="cl"><span class="n">controlplane</span> <span class="o">~</span> <span class="err">➜</span>  <span class="n">netstat</span> <span class="o">-</span><span class="n">npa</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">etcd</span> <span class="o">|</span> <span class="n">grep</span> <span class="mi">2381</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-05-09&nbsp;<a class="git-hash" href="https://github.com/minkj1992/love/commit/4e3a15c14deea583cef3bd68afa78b3fc9bdfb93" target="_blank" title="commit by minkj1992(minkj1992@gmail.com) 4e3a15c14deea583cef3bd68afa78b3fc9bdfb93: docs: cka">
                                    <i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>4e3a15c</a></span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/cka/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://minkj1992.github.io/cka/" data-title="CKA certificate" data-hashtags="dev"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://minkj1992.github.io/cka/" data-hashtag="dev"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://minkj1992.github.io/cka/" data-title="CKA certificate"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://minkj1992.github.io/cka/" data-title="CKA certificate"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://minkj1992.github.io/cka/" data-title="CKA certificate" data-image="/images/cka1.png"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/dev/">Dev</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/mlflow_doc/" class="prev" rel="prev" title="Mlflow Document"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Mlflow Document</a>
            <a href="/cka_mock_test/" class="next" rel="next" title="A Day before CKA (합격)">A Day before CKA (합격)<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.125.4">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2021 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/minkj1992" target="_blank">Minwook Je</a></span></div>
        </div>
    </footer></div>

    <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
        </a>
    </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lazysizes/ls.parent-fit.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"✨💬✨","lightTheme":"github-light","repo":"minkj1992/minkj1992.github.io"}},"data":{"id-1":"The Serious","id-2":"The Serious"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>

</html>